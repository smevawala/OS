%!PS-Adobe-3.0
%%Creator: groff version 1.19.1
%%CreationDate: Thu Nov 14 23:38:02 2013
%%DocumentNeededResources: font Times-Roman
%%+ font Times-Bold
%%+ font Courier
%%+ font Times-Italic
%%DocumentSuppliedResources: file kern.eps
%%+ procset grops 1.19 1
%%Pages: 16
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.19 1
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}bind def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/Fr{
setrgbcolor fill
}bind def
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
/Fg{
setgray fill
}bind def
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
/setpagedevice{}def
}bind def
/PEND{
clear
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Roman
%%IncludeResource: font Times-Bold
%%IncludeResource: font Courier
%%IncludeResource: font Times-Italic
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Italic@0 ENC0/Times-Italic RE/Courier@0 ENC0/Courier RE
/Times-Bold@0 ENC0/Times-Bold RE/Times-Roman@0 ENC0/Times-Roman RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)69.336 60 Q
(Unit 8/pg 1)55.998 E(\2512013 Jef)126.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Bold@0 SF(What is the K)211.806 120 Q(er)-.325 E(nel?)
-.195 E/F2 13/Times-Roman@0 SF .193(In this unit, we will be)33.336 156
R .193(gin an in-depth e)-.195 F .192(xploration of the Linux k)-.195 F
3.442(ernel. The)-.13 F .192(\214rst and most)3.442 F(ob)33.336 171 Q
(vious question is: just what e)-.195 E(xactly is the "k)-.195 E
(ernel"?!)-.13 E 3.212(The Linux k)33.336 207 R 3.213
(ernel is an unusual type of program.)-.13 F 3.213
(Most programs to which we are)9.713 F 1.141(accustomed ha)33.336 222 R
1.531 -.195(ve o)-.26 H 1.141(ne point of entry).195 F 4.39(,r)-.845 G
1.14(un for some time, and then terminate.)-4.39 F 1.14(The k)7.64 F
(ernel)-.13 E 2.264(has one initial point of entry which is used at boo\
t-time, and then multiple points of)33.336 237 R(controlled re-entry)
33.336 252 Q(.)-.845 E .997(The k)33.336 288 R .997
(ernel is compiled and link)-.13 F .997(ed just lik)-.13 F 4.247(ea)-.13
G 4.247(no)-4.247 G .997(rdinary C program, in that it consists of)
-4.247 F(man)33.336 303 Q 3.523(yi)-.195 G(ndi)-3.523 E .273
(vidual object \()-.325 F/F3 13/Courier@0 SF(.o)A F2 3.523<298c>C .273
(les which are compiled from source code \(the Linux k)-3.523 F(ernel)
-.13 E .345(is written e)33.336 318 R(xclusi)-.195 E -.195(ve)-.325 G
.345(ly in C and assembler\).).195 F -.52(Wi)6.845 G .345(thin the k).52
F .345(ernel is the equi)-.13 F -.325(va)-.325 G .345(lent of a).325 F
F3(text)3.594 E F2 .023(section, containing the e)33.336 333 R -.195(xe)
-.195 G .024(cutable code, as well as).195 F F3(data)3.274 E F2 .024
(section with v)3.274 F .024(ariable initializers.)-.325 F(Lik)33.336
348 Q 4.693(ea)-.13 G 4.693(no)-4.693 G 1.443
(rdinary C program, when the k)-4.693 F 1.443
(ernel starts it sets aside space for uninitialized)-.13 F F3(bss)33.336
363 Q F2 -.325(va)3.512 G .262(riables, and can dynamically allocate me\
mory for other data structures.).325 F .263(Also, lik)6.763 F(e)-.13 E
3.25(au)33.336 378 S(ser)-3.25 E(-le)-.26 E -.195(ve)-.325 G 3.25(lCp)
.195 G(rogram, the k)-3.25 E(ernel can dynamically load and unload e)
-.13 E -.195(xe)-.195 G(cutable modules.).195 E 2.432
(At this point, it might be instructi)33.336 414 R 2.822 -.195(ve t)
-.325 H 5.682(ol).195 G 2.432(ook at ho)-5.682 F 5.682(wt)-.325 G 2.432
(he Linux k)-5.682 F 2.431(ernel source code is)-.13 F 3.566
(arranged. The)33.336 429 R -.13(ke)3.566 G .316
(rnel can be compiled for a v).13 F .317(ariety of tar)-.325 F .317
(get architectures.)-.234 F .317(From the top-)6.817 F(le)33.336 444 Q
-.195(ve)-.325 G 5.68(ld).195 G(irectory)-5.68 E 5.68(,w)-.845 G 5.68
(es)-5.68 G 2.43(ee the follo)-5.68 F 2.43
(wing directories, each of which contains architecture-)-.325 F 1.573
(independent code.)33.336 459 R 1.574(Thus the code belo)8.073 F 4.824
(wi)-.325 G 4.824(so)-4.824 G 1.574(nly in C, not assembly)-4.824 F
8.074(.T)-.845 G 1.574(here is one top-)-8.074 F(le)33.336 474 Q -.195
(ve)-.325 G 5.037(ld).195 G 1.787(irectory called)-5.037 F F3(arch)5.037
E F2 5.037(,u)C 1.786
(nder which is one entry for each supported architecture,)-5.037 F 2.401
(and belo)33.336 489 R 5.651(we)-.325 G 2.401(ach of those is another s\
et of subdirectories with similar structure to the)-5.651 F
(architecture-independent set.)33.336 504 Q
(Here is a description of these directories:)6.5 E<83>33.336 519 Q F3
(block)4.987 E F2 4.987(:Af)C 1.736
(airly small set of utility routines pertaining to block-le)-5.117 F
-.195(ve)-.325 G 4.986(la).195 G 1.736(ccess to hard)-4.986 F(disks.)
33.336 534 Q<83>33.336 549 Q F3(crypto)3.25 E F2 3.25(:E)C
(ncryption functions.)-3.25 E<83>33.336 564 Q F3(drivers)3.266 E F2
3.266(:Av)C .016(ast set of routines for interf)-3.591 F .016
(acing with I/O de)-.13 F .016(vices, including arch-neutral)-.325 F
(stuf)33.336 579 Q 9.931(fs)-.325 G 6.681
(uch as the SCSI messaging layer)-9.931 F 9.931(,a)-.52 G 6.681
(nd support for speci\214c peripherals,)-9.931 F(motherboards, etc.)
33.336 594 Q<83>33.336 609 Q F3(fs)4.7 E F2 4.7(:R)C 1.451(outines to s\
upport the \214le system, such as open, read, write system calls.)-4.7 F
(Also)7.951 E
(subdirectories for each supported \214le system type module.)33.336 624
Q<83>33.336 639 Q F3(include)3.25 E F2 3.25(:H)C(eader \(.h\) \214les)
-3.25 E<83>33.336 654 Q F3(init)3.25 E F2 3.25(:C)C(ode which is e)-3.25
E -.195(xe)-.195 G(cuted when the system \214rst boots.).195 E<83>33.336
669 Q F3(ipc)3.25 E F2 3.25(:S)C(ystem V and POSIX IPC mechanisms)-3.25
E<83>33.336 684 Q F3(kernel)5.626 E F2 5.626(:Ac)C 2.376
(onsiderable amount of code including all of the synchronization, task)
-5.626 F(control, signals, halting and restarting the system, etc.)
33.336 699 Q<83>33.336 714 Q F3(lib)8.882 E F2 8.882(:An)C 5.633
(umber of utility routines needed by dif)-8.882 F 5.633
(ferent subsystems, including)-.325 F(synchronization primiti)33.336 729
Q -.195(ve)-.325 G 3.25(ss).195 G(uch as spin locks and semaphores.)
-3.25 E<83>33.336 744 Q F3(mm)3.25 E F2 3.25(:T)C
(he virtual memory subsystem.)-3.25 E 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 2)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF<83>33.336 120 Q/F2 13/Courier@0 SF(net)3.25 E
F1 3.25(:N)C(etw)-3.25 E(orking protocols)-.13 E<83>33.336 135 Q F2
(security)3.25 E F1 3.25(:S)C(ome e)-3.25 E(xtra stuf)-.195 E 3.25(ff)
-.325 G(or "security-hardened" v)-3.25 E(ersions of the k)-.195 E
(ernel.)-.13 E<83>33.336 150 Q F2(sound)3.25 E F1 3.25(:S)C(ound dri)
-3.25 E -.195(ve)-.325 G(rs and support).195 E 1.409(\(there are a fe)
33.336 180 R 4.659(wo)-.325 G 1.408(ther subdirectories which ha)-4.659
F 1.798 -.195(ve t)-.26 H 4.658(od).195 G 4.658(ow)-4.658 G 1.408
(ith the k)-4.658 F 1.408(ernel b)-.13 F 1.408(uild and install)-.26 F
(process b)33.336 195 Q(ut are be)-.26 E
(yond the scope of this course.\))-.195 E/F3 13/Times-Bold@0 SF(Boot-up)
244.943 225 Q F1(The follo)33.336 255 Q(wing describes ho)-.325 E 3.25
(wt)-.325 G(he linux k)-3.25 E
(ernel under X86-32 bit architecture is booted:)-.13 E 3.869<8354>33.336
270 S .619(he linux k)-3.869 F .62(ernel is compiled into an a.out-lik)
-.13 F 3.87<658c>-.13 G 3.87(le. T)-3.87 F(ypically)-1.04 E 3.87(,t)
-.845 G 3.87(os)-3.87 G -2.925 -.26(av e)-3.87 H .62(space on smaller)
4.13 F .167(bootable media, the k)33.336 285 R .167
(ernel image contains a small initialization section and the remainder)
-.13 F(is compressed.)33.336 300 Q 4.126<8354>33.336 315 S 4.126(ob)
-5.166 G .876(oot the system, the \214rmw)-4.126 F .877
(are \("BIOS"\) causes the k)-.13 F .877(ernel image to be read in from)
-.13 F 1.04(the boot de)33.336 330 R 1.04
(vice \(e.g. the hard disk\) into a speci\214c place in ph)-.325 F 1.04
(ysical memory)-.065 F 7.54(.T)-.845 G 1.04(he e)-7.54 F(xact)-.195 E
3.057(manner in which this happens will be discussed in a later unit.)
33.336 345 R 3.057(The \214rmw)9.557 F 3.057(are then)-.13 F
(transfers control to the starting address of the k)33.336 360 Q(ernel.)
-.13 E 4.389<8354>33.336 375 S 1.139(he k)-4.389 F 1.139
(ernel initially runs in supervisor mode, b)-.13 F 1.139
(ut with all address translation hardw)-.26 F(are)-.13 E 1.269
(turned of)33.336 390 R 4.519(f. Thus)-.325 F 1.269
(the \214rst part of the k)4.519 F(ernel')-.13 E 4.519(si)-.715 G 1.269
(nitialization routines ha)-4.519 F 1.659 -.195(ve b)-.26 H 1.269
(een compiled).195 F 1.304(and link)33.336 405 R 1.304(ed with a speci\
\214c address in mind which corresponds to the load address.)-.13 F(The)
7.803 E(ne)33.336 420 Q .11
(xt task is to de-compress the image which is in one place in ph)-.195 F
.111(ysical memory and write)-.065 F 4.751(it to another location.)
33.336 435 R -.195(Fo)11.251 G 8.001(rt).195 G 4.75
(he \(32-bit\) x86 architecture, this is ph)-8.001 F 4.75
(ysical address)-.065 F F2(0x00100000)33.336 450 Q F1 6.5(.A)C
(jump is then made to that ph)-3.25 E(ysical address.)-.065 E 4.354
<8341>33.336 465 S 4.354(ta)-4.354 G 1.104(round this time, the k)-4.354
F 1.104(ernel turns on virtual address translation.)-.13 F 1.105
(On the x86 32-bit)7.604 F 1.967(architecture, the Linux k)33.336 480 R
1.967(ernel uses virtual addresses belo)-.13 F 5.217(w0)-.325 G 1.967
(xC000000 e)-5.217 F(xclusi)-.195 E -.195(ve)-.325 G 1.966(ly for).195 F
(user)33.336 495 Q(-le)-.26 E -.195(ve)-.325 G 6.131(lp).195 G 2.881
(rocesses, and reserv)-6.131 F 2.881
(es the 0xC000000-0xFFFFFFFF range e)-.195 F(xclusi)-.195 E -.195(ve)
-.325 G 2.882(ly for).195 F -.13(ke)33.336 510 S .937(rnel memory).13 F
7.437(.W)-.845 G(e')-8.477 E .937(ll see ho)-.13 F 4.187(wt)-.325 G .937
(his is e)-4.187 F .937(xploited to accomplish f)-.195 F .937
(ast access to k)-.13 F .936(ernel data)-.13 F(structures.)33.336 525 Q
F3 1.043(Note: All parts of the k)7.543 F(er)-.13 E 1.043
(nel see the same virtual addr)-.195 F 1.043(ess mappings.)-.234 F F1
-1.04(To)7.543 G 1.052(get the k)33.336 540 R 1.052
(ernel running on virtual, rather than ph)-.13 F 1.052
(ysical addresses, page tables are created)-.065 F 4.736
(which map 0xC00000000 to ph)33.336 555 R 4.737
(ysical address 0x00100000, and so on for higher)-.065 F .51
(addresses, until the entire static part of the k)33.336 570 R .51
(ernel \(te)-.13 F .509(xt, data, bss\) has been mapped.)-.195 F(The)
7.009 E(bss pages are e)33.336 585 Q
(xplicitly zero-\214lled at this time.)-.195 E 3.25<8354>33.336 600 S
(he MMU is turned on and thereafter the k)-3.25 E
(ernel runs on virtual addresses.)-.13 E 6.221<8354>33.336 615 S 2.971
(he interrupt v)-6.221 F 2.971(ector tables are appropriately initializ\
ed \(see "Interrupt Handling in)-.195 F(Hardw)33.336 630 Q(are" belo)
-.13 E(w\).)-.325 E 6.373<8354>33.336 645 S 3.123(he k)-6.373 F 3.122
(ernel then calls initialization routines for its v)-.13 F 3.122
(arious subsystems, e.g. virtual)-.325 F(memory)33.336 660 Q 3.428<2c8c>
-.845 G .178(le systems, scheduling.)-3.428 F(The)6.678 E 3.428(ya)-.195
G .178(llocate dynamic k)-3.428 F .179(ernel memory as needed.)-.13 F
(An)9.929 E(in)33.336 675 Q -.195(ve)-.52 G .884(ntory of hardw).195 F
.884(are de)-.13 F .884(vices is tak)-.325 F .884
(en and the initialization routines for each de)-.13 F .884(vice are)
-.325 F(called.)33.336 690 Q 3.25<8349>33.336 705 S(nterrupts are no)
-3.25 E 3.25(we)-.325 G(nabled.)-3.25 E 3.743<834e>33.336 720 S 1.143
-.325(ow t)-3.743 H .493(he k).325 F .493(ernel is able to pro)-.13 F
.493(vide its services, b)-.195 F .493(ut has no user)-.26 F .494
(-mode processes to which)-.26 F(the)33.336 735 Q 4.727(yc)-.195 G 1.477
(an be pro)-4.727 F 1.477(vided yet.)-.195 F 1.477(The de)7.977 F 1.477
(vice which contains the root \214lesystem is determined)-.325 F 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 3)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF(from information passed during boot loading, a\
nd the root \214lesystem is mounted.)33.336 120 Q 3.688<8354>33.336 135
S .438(he k)-3.688 F .438
(ernel creates process #1 and causes that process to e)-.13 F -.195(xe)
-.195 G 3.689(cas).195 G .439(peci\214c binary program)-3.689 F(\()
33.336 150 Q/F2 13/Courier@0 SF(/sbin/init)A F1 1.032
(\), running as the super)B 1.032(-user \(uid and gid = 0\).)-.26 F
1.032(This "init" program must)7.532 F 2.035
(reside on the root \214lesystem, and is the bridge between k)33.336 165
R 2.035(ernel initialization and user)-.13 F(-)-.26 E
(mode initialization.)33.336 180 Q
(It remains running for the life of the system.)6.5 E 3.511<8346>33.336
195 S(irst,)-3.511 E F2(init)3.511 E F1 .261(runs a series of programs \
and shell scripts which complete the initialization)3.511 F .716
(of the system.)33.336 210 R .716
(This includes locating and mounting other \214lesystem v)7.216 F .716
(olumes as needed.)-.26 F 3.02(Then, init spa)33.336 225 R 3.02
(wns other user)-.195 F 3.02(-mode programs which ultimately pro)-.26 F
3.019(vide access to the)-.195 F(machine for the end-user)33.336 240 Q
(.)-.715 E 2.682(\(When booting up a multiprocessor machine, the BIOS s\
tarts the machine in single-)33.336 270 R .095(processor mode.)33.336
285 R -.195(Fa)6.595 G .094(irly late in the k).195 F(ernel')-.13 E
3.344(si)-.715 G .094(nitialization, the other processors are enabled.)
-3.344 F(The)33.336 300 Q 4.336(ya)-.195 G 1.086(re initially gi)-4.336
F -.195(ve)-.325 G 4.337(nt).195 G(he)-4.337 E/F3 13/Times-Italic@0 SF
1.087(idle task)4.337 F F1 1.087(to run.)4.337 F 1.087
(Once additional processes other than pid 1)7.587 F
(are runnable, the other CPUs will start to pick up their loads.)33.336
315 Q/F4 13/Times-Bold@0 SF(Re-entering the k)205.04 345 Q(er)-.13 E
(nel)-.195 E F1 3.084 -1.04(We h)33.336 381 T -2.925 -.26(av e)1.04 H
1.004(seen that there is one initial entrypoint to the k)4.514 F 1.003
(ernel, through the boot process.)-.13 F(Thereafter)33.336 396 Q 3.881
(,t)-.52 G .631(he k)-3.881 F .631(ernel relinquishes control to user)
-.13 F .631(-mode processes.)-.26 F .631(The k)7.131 F .631
(ernel is entered)-.13 F(ag)33.336 411 Q
(ain only through the interrupt mechanism.)-.065 E 2.08 -1.04(We c)
33.336 432 T(an broadly di)1.04 E(vide re-entry into tw)-.325 E 3.25(oc)
-.13 G(ate)-3.25 E(gories:)-.195 E<83>33.336 447 Q F4(Synchr)6.647 E
(onous)-.234 E F1 6.647(:W)C 3.397
(hen the interupt is raised because of the e)-6.647 F -.195(xe)-.195 G
3.397(cution of a speci\214c).195 F 2.211
(instruction, that is said to be synchronous.)33.336 462 R 2.211
(The Linux k)8.711 F 2.211(ernel calls these synchronous)-.13 F -2.795
-.325(ev e)33.336 477 T(nts).325 E F4(Exceptions)4.654 E F1 7.904(.O)C
1.404(ther similar terms are "F)-7.904 F 1.404(ault" and "T)-.195 F
4.654(rap". Exceptions)-.455 F 1.404(are said to)4.654 F 2.672
(occur in the conte)33.336 492 R 2.672
(xt of a particular running process.)-.195 F 2.672(The k)9.172 F 2.672
(ernel associates a unique)-.13 F -.13(ke)33.336 507 S 1.057
(rnel-mode stack for each process \(or to be precise, for each user).13
F(-le)-.26 E -.195(ve)-.325 G 4.306(lt).195 G 1.056(hread\), and so)
-4.306 F .356(we can think of the k)33.336 522 R .356
(ernel as containing one k)-.13 F .356
(ernel-mode thread of control for each user)-.13 F(-)-.26 E(le)33.336
537 Q -.195(ve)-.325 G 4.102(lt).195 G .852(hread, which gets acti)
-4.102 F -.325(va)-.325 G .852(ted when an e).325 F .851
(xception is raised.)-.195 F .851(Thus the handling of the)7.351 F -.195
(ex)33.336 552 S .572(ception in the k).195 F .572(ernel is in ef)-.13 F
.572(fect a controlled e)-.325 F .572(xtension of the user)-.195 F(-le)
-.26 E -.195(ve)-.325 G 3.822(lt).195 G .572(hread into the)-3.822 F
-.13(ke)33.336 567 S(rnel.).13 E<83>33.336 582 Q F4(Asynchr)5.037 E
(onous)-.234 E F1 5.037(:T)C 1.787(hese e)-5.037 F -.195(ve)-.325 G
1.786(nts are not correlated with a speci\214c instruction, b).195 F
1.786(ut come)-.26 F 2.016(from hardw)33.336 597 R 2.016(are de)-.13 F
5.266(vices. The)-.325 F 2.016(Linux k)5.266 F 2.016
(ernel calls these "Interrupts", which is some)-.13 F(what)-.325 E .501
(ambiguous because Exceptions are also a form of interrupt.)33.336 612 R
.501(Asynchronous interrupts are)7.001 F(handled on whate)33.336 627 Q
-.195(ve)-.325 G 3.25(rk).195 G(ernel-mode stack happens to be acti)
-3.38 E .39 -.195(ve a)-.325 H 3.25(tt).195 G(he time.)-3.25 E .434
(In most operating systems literature, synchronous entries to the k)
33.336 648 R .435(ernel are said to be ")-.13 F F3(top)A(half)33.336 663
Q F1 2.168(," and asynchronous are said to be in the ")B F3 2.168
(bottom half)B F1 5.418(". Unfortunately)B 2.168(the Linux)5.418 F -.13
(ke)33.336 678 S .127
(rnel uses the term "bottom half" in an inconsistent manner).13 F 3.377
(,s)-.52 G 3.377(ow)-3.377 G 3.378(ew)-3.377 G .128(ill a)-3.378 F -.26
(vo)-.26 G .128(id top/bottom).26 F
(half terminology to reduce confusion.)33.336 693 Q F4(Exception T)
221.771 723 Q(ypes)-.962 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 4)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF 3.524<834d>33.336 120 S(an)-3.524 E 3.524(ye)
-.195 G .274(xceptions are the result of program error)-3.719 F 6.774
(.T)-.715 G .274(hese are also called)-6.774 F/F2 13/Times-Bold@0 SF
(faults)3.524 E F1 3.523(.Af)C .273(ault is)-3.653 F 2.732
(de\214ned as a condition which pre)33.336 135 R -.195(ve)-.325 G 2.732
(nts the current opcode from being e).195 F -.195(xe)-.195 G 5.983
(cuted. The).195 F(def)33.336 150 Q .675(ault beha)-.13 F .675
(vior of the k)-.26 F .675(ernel for most f)-.13 F .674
(aults is to post a signal to the of)-.13 F .674(fending process.)-.325
F(Examples of such f)33.336 165 Q(aults include: inte)-.13 E(ger di)
-.195 E(vide by 0 and ille)-.325 E -.065(ga)-.195 G 3.25(li).065 G
(nstruction.)-3.25 E 4.7<8341>33.336 180 S F2 -.13(Pa)C 1.45(ge F).13 F
(ault)-.325 E F1 -.195(ex)4.7 G 1.45(ception occurs when the hardw).195
F 1.451(are w)-.13 F 1.451(as unable to perform a memory)-.13 F 4.875
(access. On)33.336 195 R 1.625(the x86-32 architecture, this same f)
4.875 F 1.625(ault type is used both for when a v)-.13 F(alid)-.325 E
2.205(PTE can not be found and for a protection violation, the distinct\
ion between the tw)33.336 210 R(o)-.13 E .472(being passed to the f)
33.336 225 R .472(ault handler by hardw)-.13 F .471
(are in a speci\214c re)-.13 F(gister)-.195 E 6.971(.P)-.715 G .471
(age F)-7.166 F .471(aults are quite)-.195 F
(normal and not necessarily a sign of program error)33.336 240 Q 3.25
(,a)-.52 G 3.25(sd)-3.25 G(iscussed in Unit 5.)-3.25 E 4.202<8354>33.336
255 S .952(he k)-4.202 F .952(ernel uses some e)-.13 F .953
(xceptions to be cle)-.195 F -.195(ve)-.325 G 4.203(ra).195 G .953
(nd ef)-4.203 F .953(\214cient about things.)-.325 F -.195(Fo)7.453 G
4.203(re).195 G(xample,)-4.398 E .489(the k)33.336 270 R .489
(ernel usually does not bother with \215oating point re)-.13 F 3.738
(gisters. It)-.195 F .488(turns the \215oating point)3.738 F 3.275
(unit of)33.336 285 R 3.275(f, and then if the process tries to use a \
\215oating-point operation, it raises an)-.325 F -.195(ex)33.336 300 S
.685(ception and the k).195 F .685(ernel kno)-.13 F .685
(ws that it needs to w)-.325 F .685(orry about it for that process.)-.13
F .684(So these)7.185 F -.195(ex)33.336 315 S .762(ceptions are lik).195
F 4.012(eaP)-.13 G .762(age F)-4.207 F .762(ault, in that the k)-.195 F
(ernel')-.13 E 4.013(sh)-.715 G .763(andler must determine whether the)
-4.013 F -.195(ex)33.336 330 S
(ception is benign or the result of an errant program.).195 E 3.452
<8357>33.336 345 S .202(hen f)-3.452 F .202(aults are resolv)-.13 F .202
(ed successfully by the k)-.195 F .202
(ernel, control returns to user le)-.13 F -.195(ve)-.325 G 3.452(la).195
G .201(nd the)-3.452 F(pre)33.336 360 Q(viously f)-.325 E
(aulted instruction is re-tried, and this time should succeed.)-.13 E
3.549<8341>33.336 375 S F2 .3(System Call)B F1 .3
(is a particularly important type of e)3.55 F .3(xception, and we')-.195
F .3(ll spend some time)-.13 F(looking at system calls in detail.)33.336
390 Q F2(Interrupt T)223.22 420 Q(ypes)-.962 E F1 3.631<8348>33.336 450
S(ardw)-3.631 E .381(are de)-.13 F .381
(vices will raise interrupts to indicate that the)-.325 F 3.63(yh)-.195
G -2.925 -.26(av e)-3.63 H .38(entered a ready or non-)3.89 F
(ready state, that data are a)33.336 465 Q -.325(va)-.26 G
(ilable, or that a data transfer operation has completed.).325 E 6.614
<8354>33.336 480 S 3.364(he k)-6.614 F 3.364
(ernel programs a chip on the motherboard to deli)-.13 F -.195(ve)-.325
G 6.614(rap).195 G 3.364(eriodic "heartbeat")-6.614 F .701
(interrupt, e.g. e)33.336 495 R -.195(ve)-.325 G .701(ry millisecond.)
.195 F .701(This Periodic Interv)7.201 F .701(al T)-.325 F .701
(imer \(PIT\) is v)-.455 F .701(ery important to)-.195 F 7.741
(the scheduler)33.336 510 R 14.241(.O)-.715 G 7.741(ther time-based e)
-14.241 F -.195(ve)-.325 G 7.742(nts in the k).195 F 7.742
(ernel \(e.g. netw)-.13 F 7.742(ork protocol)-.13 F
(retransmission timers\) are deri)33.336 525 Q -.195(ve)-.325 G 3.25(df)
.195 G(rom this clock source.)-3.25 E 3.992<834f>33.336 540 S 3.992(nam)
-3.992 G .742(ulti-processor system, one processor may e)-3.992 F -.195
(xe)-.195 G .742(cute a series of instructions which).195 F 2.082
(cause a hardw)33.336 555 R 2.082
(are interrupt to be posted to the other processors.)-.13 F 2.083
(This is kno)8.583 F 2.083(wn as an)-.325 F F2(Inter)33.336 570 Q(-pr)
-.481 E .123(ocessor Interrupt \(IPI\))-.234 F F1 6.623(.T)C .123
(he Linux k)-6.623 F .122(ernel uses this in se)-.13 F -.195(ve)-.325 G
.122(ral speci\214c cases: \(a\)).195 F 3.563 -1.04(To s)33.336 585 T
1.483(hut do)1.04 F 1.484(wn the system)-.325 F 1.484
(\(b\) to request that the other processors re-e)7.984 F 1.484
(xamine their task)-.195 F(scheduling \(co)33.336 600 Q -.195(ve)-.195 G
(red in ne).195 E(xt unit\))-.195 E(\(c\) to pur)6.5 E
(ge stale TLB entries.)-.234 E 3.513<8348>33.336 615 S(ardw)-3.513 E
.263(are will deli)-.13 F -.195(ve)-.325 G 3.513(ri).195 G .263
(nterrupts to notify the k)-3.513 F .263(ernel of important system e)
-.13 F -.195(ve)-.325 G .262(nts, such as).195 F 4.191(ah)33.336 630 S
(ardw)-4.191 E .941(are f)-.13 F .941(ailure, battery po)-.13 F .941
(wer f)-.325 F .941(ailure, etc.)-.13 F .942
(If continued system operation is possible,)7.441 F .093(the k)33.336
645 R .092(ernel will ultimately translate these into user)-.13 F .092
(-mode e)-.26 F -.195(ve)-.325 G 3.342(nts. Otherwise).195 F .092(the k)
3.342 F .092(ernel will)-.13 F(print out an informati)33.336 660 Q .39
-.195(ve m)-.325 H(essage and halt the system.).195 E F2(Important Shar)
122.08 690 Q(ed Pr)-.234 E(ocessor/K)-.234 E(er)-.325 E
(nel Data Structur)-.195 E(es)-.234 E F1 2.998(The beha)33.336 726 R
2.998(vior of the CPU is hard-wired \(or programmed in its microcode\) \
and thus)-.26 F 2.912(immutable to an)33.336 741 R 6.162(ys)-.195 G
(oftw)-6.162 E 2.912(are code including the k)-.13 F 6.162(ernel. The)
-.13 F -.13(ke)6.162 G 2.912(rnel is compiled for a).13 F 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 5)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF .798(speci\214c architecture and kno)33.336 120
R .798(ws about data structures that the processor e)-.325 F .798
(xpects to see in)-.195 F(memory)33.336 135 Q 3.491(,w)-.845 G .241
(hich control ho)-3.491 F 3.491(wt)-.325 G .24
(he processor reacts to certain e)-3.491 F -.195(ve)-.325 G 3.49
(nts. Because).195 F .24(the processor)3.49 F 1.11
(itself must respond to virtual memory lookup f)33.336 150 R 1.111
(ailures \(page f)-.13 F 1.111(aults\) these data structures)-.13 F
1.307(are typically de\214ned at ph)33.336 165 R 1.306
(ysical, rather than virtual memory addresses.)-.065 F 1.306
(On the X86-32)7.806 F(bit architecture, these data structures are:)
33.336 180 Q 4.804<8354>33.336 195 S(he)-4.804 E/F2 13/Times-Bold@0 SF
1.554(Interrupt Descriptor T)4.804 F 1.554(able \(IDT\))-1.196 F F1
1.554(is an array of 256 interrupt descriptors.)4.804 F(The)8.054 E(ph)
33.336 210 Q 2.118(ysical address of this array is set via the special)
-.065 F/F3 13/Courier@0 SF(idtr)5.368 E F1(re)5.368 E(gister)-.195 E
5.368(,w)-.52 G 2.118(hich can only be)-5.368 F .733
(accessed through special pri)33.336 225 R(vile)-.325 E .733
(ged instructions LIDT and SIDT)-.195 F 7.233(.A)-.962 G .734
(lthough the structure)-7.233 F 2.451
(of the IDT is baroque because of le)33.336 240 R -.065(ga)-.195 G 2.84
-.195(cy X).065 H 2.45(86 se).195 F 2.45
(gmented memory model issues, it is)-.195 F 1.426(basically a table of \
program counter \(%eip\) addresses, which are the handler addresses)
33.336 255 R .955
(\(virtual addresses\) for each of the 256 possible interrupt or e)
33.336 270 R(xception/f)-.195 E .954(ault v)-.13 F 4.204(ectors. The)
-.195 F -.13(ke)33.336 285 S 1.769
(rnel has initialized all IDT entries to point to v).13 F 1.769(alid k)
-.325 F 1.769(ernel functions before allo)-.13 F(wing)-.325 E(user)
33.336 300 Q(-le)-.26 E -.195(ve)-.325 G 4.055(lc).195 G .805(ode to be)
-4.055 F .805(gin e)-.195 F -.195(xe)-.195 G .805
(cution after system boot.).195 F .805
(The IDT is generally not modi\214ed)7.305 F(after this.)33.336 315 Q
4.322<8354>33.336 330 S(he)-4.322 E F2 -1.196(Ta)4.322 G 1.072
(sk State Segment \(TSS\))1.196 F F1 1.072
(is a small data structure which resides inside a lar)4.322 F(ger)-.234
E .928(data structure kno)33.336 345 R .928
(wn as the Global Descriptor T)-.325 F .928(able \(GDT\).)-1.04 F .928
(The Linux k)7.428 F .928(ernel does not)-.13 F .616
(utilize all of the functionality that is a)33.336 360 R -.325(va)-.26 G
.617(ilable with the TSS, b).325 F .617(ut uses it simply to control)
-.26 F 3.01
(the stack pointer address that will be used during interrupt/e)33.336
375 R 3.01(xception handling.)-.195 F(The)9.51 E(special)33.336 390 Q F3
(tr)3.984 E F1(re)3.984 E .734
(gister controls the location of the TSS and is generally set once.)
-.195 F .735(On multi-)7.234 F
(processor systems, there is a TSS for each processor)33.336 405 Q(.)
-.715 E 4.708<8354>33.336 420 S 1.458
(he page table, which has been described conceptually in pre)-4.708 F
1.458(vious units, and will be)-.325 F 1.309
(described in greater detail in a subsequent unit.)33.336 435 R(The)
7.809 E F3(cr3)4.559 E F1(re)4.559 E 1.309(gister controls the ph)-.195
F(ysical)-.065 E(address of the highest-le)33.336 450 Q -.195(ve)-.325 G
3.25(lp).195 G(age table \(which linux calls the P)-3.25 E
(age Global Directory\).)-.195 E F2
(Interrupt and Exception handling in hard)137.713 495 Q(war)-.195 E(e)
-.234 E F1 .168(On the 32-bit X86 architecture, the follo)33.336 531 R
.168(wing steps are tak)-.325 F .168(en by the processor in response)
-.13 F(to an interrupt or e)33.336 546 Q(xception:)-.195 E 3.353<8345>
33.336 561 S .103(ach interrupt or e)-3.353 F .103
(xception has an associated)-.195 F F2 -.13(ve)3.353 G(ctor).13 E F1
.103(between 0 and 255.)3.353 F .104(This is used to)6.603 F(inde)33.336
576 Q 5.172(xt)-.195 G 1.922(he IDT)-5.172 F 5.172(,f)-.962 G 1.921
(rom which the handler address is fetched.)-5.172 F 1.921
(The handler address is the)8.421 F 1.627(virtual address of the \214rs\
t opcode of the associated handler function within the k)33.336 591 R
(ernel.)-.13 E 1.099
(This function is generally written in assembly language.)33.336 606 R
1.099(The k)7.599 F 1.099(ernel has made sure that)-.13 F
(all 256 entries ha)33.336 621 Q .39 -.195(ve v)-.26 H
(alid handler addresses.)-.13 E 4.237<8357>33.336 636 S .987(hen the pr\
ocessor is currently running in User mode, it fetches the TSS.)-4.237 F
-.52(Wi)7.488 G .988(thin the).52 F .562(TSS is the ne)33.336 651 R
3.812(wv)-.325 G .562(alue \(virtual address\) of the stack pointer)
-4.137 F 7.061(.T)-.715 G .561(his will be the k)-7.061 F(ernel-mode)
-.13 E 1.114(stack, as described later)33.336 666 R 7.614(.T)-.715 G
1.114(he k)-7.614 F 1.114(ernel maintains a separate k)-.13 F 1.114
(ernel stack for each process,)-.13 F .595(and mak)33.336 681 R .595
(es sure the correct stack address w)-.13 F .594
(as placed within the TSS before performing a)-.13 F(conte)33.336 696 Q
.72(xt switch.)-.195 F .72(If ho)7.22 F(we)-.325 E -.195(ve)-.325 G 1.76
-.52(r, t).195 H .72(he processor w).52 F .721
(as already in Supervisor mode at the time of)-.13 F 1.028(the e)33.336
711 R 1.028
(xception/interrupt, then the stack pointer is already within a v)-.195
F 1.028(alid k)-.325 F 1.028(ernel stack, and)-.13 F
(the TSS is not used by the processor)33.336 726 Q(.)-.715 E 4.999<8354>
33.336 741 S 1.749(he processor no)-4.999 F 4.999(wt)-.325 G 1.749
(ransitions to Supervisor mode, and the %esp re)-4.999 F 1.749
(gister is pointing)-.195 F 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 6)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF(within the k)33.336 120 Q
(ernel-mode stack for the task.)-.13 E 3.551<8354>33.336 135 S .301
(he processor pushes onto the k)-3.551 F .301(ernel-mode stack the v)
-.13 F .301(alue of the old \(user)-.325 F .3(-mode\) stack)-.26 F 3.742
(pointer re)33.336 150 R(gister)-.195 E/F2 13/Courier@0 SF(%esp)6.992 E
F1 6.992(,t)C 3.743(he \215ags/status re)-6.992 F(gister)-.195 E F2
(%eflags)6.993 E F1 6.993(,a)C 3.743(nd the program counter)-6.993 F(re)
33.336 165 Q(gister)-.195 E F2(%eip)4.008 E F1 7.258(.T)C(he)-7.258 E F2
(%cs)4.008 E F1(and)7.258 E F2(%ss)4.008 E F1(re)4.008 E .758
(gisters \(which ha)-.195 F 1.147 -.195(ve t)-.26 H 4.007(od).195 G
4.007(ow)-4.007 G .757(ith ho)-4.007 F 4.007(wc)-.325 G .757
(ode and stack)-4.007 F .544(memory are accessed\) are also sa)33.336
180 R -.195(ve)-.26 G 3.794(d. This).195 F .544(set of 5 re)3.794 F .545
(gisters is critical because it is what)-.195 F(the hardw)33.336 195 Q
(are relies on to determine where the stack is, and where the ne)-.13 E
(xt instruction is.)-.195 E 3.653<8346>33.336 210 S .403
(or certain types of e)-3.848 F .403
(xceptions, the processor pushes an error code onto the stack.)-.195 F
(This)6.903 E
(is used, e.g., to distinguish between a page translation f)33.336 225 Q
(ault and a page protection f)-.13 E(ault.)-.13 E 4.262<8354>33.336 240
S 1.012(he program counter location of the handler)-4.262 F 4.262(,w)
-.52 G 1.012(hich w)-4.262 F 1.012(as fetched from the IDT)-.13 F 4.263
(,i)-.962 G 4.263(sn)-4.263 G -.325(ow)-4.263 G(loaded into the)33.336
255 Q F2(eip)3.25 E F1(re)3.25 E(gister)-.195 E 3.25(,e)-.52 G -.325(ff)
-3.25 G(ecting a jump to that entrypoint.).325 E 4.592<8352>33.336 270 S
1.342(ecall that the k)-4.592 F 1.342
(ernel controls the page tables, and establishes them for each process.)
-.13 F 1.445(The k)33.336 285 R 1.445
(ernel virtual address space, 0xC0000000-0xFFFFFFFF)-.13 F 4.696(,i)
-1.04 G 4.696(sa)-4.696 G -.13(lwa)-4.696 G 1.446(ys present in these)
.13 F .019(page tables, b)33.336 300 R .019(ut the Pri)-.26 F(vile)-.325
E .019(ged \215ags in the P)-.195 F .019(age T)-.195 F .018
(able Entries are set so user processes can)-1.04 F .281
(not directly access the k)33.336 315 R .282(ernel memory \(this w)-.13
F .282(ould be really bad....ho)-.13 F(we)-.325 E -.195(ve)-.325 G 3.532
(ru).195 G .282(ser processes)-3.532 F 1.37
(running as root can use a pseudo-de)33.336 330 R(vice)-.325 E F2
(/dev/kmem)4.62 E F1 1.37(to access k)4.62 F 1.369
(ernel memory as if it)-.13 F .305(were a \214le\).)33.336 345 R .305
(This page table arrangement means that as soon as control enters the k)
6.805 F(ernel,)-.13 E(the shared k)33.336 360 Q
(ernel address space is immediately a)-.13 E -.325(va)-.26 G(ilable.)
.325 E(An)33.336 396 Q 4.332(yi)-.195 G 1.082(nterrupt or e)-4.332 F
1.081(xception handler ultimately terminates by e)-.195 F -.195(xe)-.195
G 1.081(cuting the special).195 F F2(iret)4.331 E F1
(instruction, which:)33.336 411 Q 3.25<8350>33.336 426 S(ops the 5 re)
-3.25 E(gisters from the stack which had been sa)-.195 E -.195(ve)-.26 G
3.25(db).195 G 3.25(yh)-3.25 G(ardw)-3.25 E(are.)-.13 E 3.25<8352>33.336
441 S(esets the pri)-3.25 E(vile)-.325 E(ge le)-.195 E -.195(ve)-.325 G
3.25(lt).195 G 3.25(ot)-3.25 G(he pre)-3.25 E(vious v)-.325 E(alue)-.325
E 3.695<8352>33.336 456 S .445(esumes e)-3.695 F -.195(xe)-.195 G .446
(cution with the stack pointer no).195 F 3.696(ws)-.325 G .446
(et back to the original user)-3.696 F .446(-mode stack.)-.26 F 1.472
(Interrupts occur between instructions, and so e)33.336 471 R -.195(xe)
-.195 G 1.471(cution resumes at the ne).195 F 1.471(xt instruction.)
-.195 F -.195(Fo)33.336 486 S 7.325(re).195 G 4.075
(xception returns, if the instruction caused a f)-7.52 F 4.075
(ault \(e.g. P)-.13 F 4.075(age F)-.195 F 4.075(ault\) then that)-.195 F
(instruction is re-started, otherwise the ne)33.336 501 Q
(xt instruction is e)-.195 E -.195(xe)-.195 G(cuted.).195 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 7)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E 0 0 468 604 -304.51 393 33.336 424.51 PBEGIN
%%BeginDocument: kern.eps
%!PS-Adobe-2.0 EPSF-2.0
%%Title: kern.fig
%%Creator: fig2dev Version 3.2 Patchlevel 4
%%CreationDate: Fri Oct 30 02:56:03 2009
%%For: hak@lex ()
%%BoundingBox: 0 0 604 393
%%Magnification: 1.0000
%%EndComments
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
newpath 0 393 moveto 0 0 lineto 604 0 lineto 604 393 lineto closepath clip newpath
-36.0 414.7 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/reencdict 12 dict def /ReEncode { reencdict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq
{ exch dup length array copy newfont 3 1 roll put }
{ exch newfont 3 1 roll put } ifelse } { pop pop } ifelse } forall
newfont /FontName newfontname put newcodesandnames aload pop
128 1 255 { newfont /Encoding get exch /.notdef put } for
newcodesandnames length 2 idiv { newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/isovec [
8#055 /minus 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde
8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis
8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron
8#220 /dotlessi 8#230 /oe 8#231 /OE
8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling
8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis
8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot
8#255 /hyphen 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus
8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph
8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine
8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf
8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute
8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring
8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute
8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute
8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve
8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply
8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex
8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave
8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring
8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute
8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute
8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve
8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide
8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex
8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis] def
/Times-Roman /Times-Roman-iso isovec ReEncode
 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y tr xrad yrad sc 0 0 1 startangle endangle arc
	closepath
	savematrix setmatrix
	} def

/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
0 slj 0 slc
 0.06000 0.06000 sc
%
% Fig objects follow
%
% 
% here starts figure with depth 50
% Ellipse
7.500 slw
n 6450 6375 3225 450 0 360 DrawEllipse gs col0 s gr

% Polyline
n 1875 3825 m 10650 3825 l 10650 6900 l 1875 6900 l
 cp gs col0 s gr 
% Polyline
n 4125 3825 m 5250 3825 l 5250 825 l 4125 825 l
 cp gs col0 s gr 
% Polyline
n 5925 3825 m 7050 3825 l 7050 825 l 5925 825 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 7875 3825 m 9000 3825 l 9000 4950 l 7875 4950 l
 cp gs col0 s gr  [] 0 sd
% Polyline
gs  clippath
3124 728 m 3148 783 l 3287 723 l 3165 743 l 3263 668 l cp
eoclip
n 3675 525 m
 3150 750 l gs col0 s gr gr

% arrowhead
n 3263 668 m 3165 743 l 3287 723 l  col0 s
% Polyline
gs  clippath
4691 750 m 4745 776 l 4812 641 l 4732 735 l 4758 614 l cp
eoclip
n 4800 600 m
 4725 750 l gs col0 s gr gr

% arrowhead
n 4758 614 m 4732 735 l 4812 641 l  col0 s
% Polyline
gs  clippath
6459 707 m 6470 648 l 6321 621 l 6434 672 l 6310 680 l cp
eoclip
n 5625 525 m
 6450 675 l gs col0 s gr gr

% arrowhead
n 6310 680 m 6434 672 l 6321 621 l  col0 s
% Polyline
gs  clippath
2777 4541 m 2746 4592 l 2875 4672 l 2789 4584 l 2907 4620 l cp
eoclip
n 4500 5625 m
 2775 4575 l gs col0 s gr gr

% arrowhead
n 2907 4620 m 2789 4584 l 2875 4672 l  col0 s
% Polyline
gs  clippath
4823 4401 m 4766 4420 l 4814 4564 l 4805 4441 l 4871 4545 l cp
eoclip
n 5175 5550 m
 4800 4425 l gs col0 s gr gr

% arrowhead
n 4871 4545 m 4805 4441 l 4814 4564 l  col0 s
% Polyline
gs  clippath
6633 4500 m 6579 4473 l 6512 4608 l 6593 4515 l 6566 4635 l cp
eoclip
n 6075 5550 m
 6600 4500 l gs col0 s gr gr

% arrowhead
n 6566 4635 m 6593 4515 l 6512 4608 l  col0 s
% Polyline
n 2250 3825 m 3375 3825 l 3375 825 l 2250 825 l
 cp gs col0 s gr 
% Polyline
 [60] 0 sd
n 2250 4125 m 3375 4125 l 3375 5250 l 2250 5250 l
 cp gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 4125 3900 m 5250 3900 l 5250 5025 l 4125 5025 l
 cp gs col0 s gr  [] 0 sd
% Polyline
 [60] 0 sd
n 5925 4425 m 7050 4425 l 7050 5550 l 5925 5550 l
 cp gs col0 s gr  [] 0 sd
% Polyline
gs  clippath
8327 4391 m 8296 4443 l 8427 4519 l 8339 4433 l 8457 4467 l cp
eoclip
n 9750 5250 m
 8325 4425 l gs col0 s gr gr

% arrowhead
n 8457 4467 m 8339 4433 l 8427 4519 l  col0 s
/Times-Roman-iso ff 200.00 scf sf
900 900 m
gs 1 -1 sc (0x0000 0000) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
900 3675 m
gs 1 -1 sc (0xBFFF FFFF) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
600 3975 m
gs 1 -1 sc (0xC000 0000) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
600 6825 m
gs 1 -1 sc (0xFFFF FFFF) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
3825 525 m
gs 1 -1 sc (user-level processes) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
8325 5400 m
gs 1 -1 sc (kernel-only thread) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4275 5850 m
gs 1 -1 sc (kernel-mode per-thread stacks) col0 sh gr
/Times-Roman-iso ff 200.00 scf sf
4500 6375 m
gs 1 -1 sc (shared kernel data structures) col0 sh gr
% here ends figure;
$F2psEnd
rs
showpage
%%EndDocument
end PEND/F1 13/Times-Bold@0 SF -.325(Ke)197.181 475.51 S -.195(rn).325 G
(el contr).195 E(ol \215o)-.234 E 3.25(wp)-.13 G(aths)-3.25 E/F2 13
/Times-Roman@0 SF(No)33.336 511.51 Q 4.613(wt)-.325 G 1.363(hat we')
-4.613 F 1.753 -.195(ve s)-.65 H 1.362(een the types of k).195 F 1.362
(ernel entrypoints, lets continue further to talk about)-.13 F(ho)33.336
526.51 Q 3.25(wc)-.325 G(ontrol \215o)-3.25 E(ws within the k)-.325 E
(ernel and back out ag)-.13 E(ain.)-.065 E(At an)33.336 547.51 Q 3.25
(yg)-.195 G -2.795 -.325(iv e)-3.25 H 3.25(nm).325 G
(oment, a CPU is either:)-3.25 E 3.25<8345>33.336 562.51 S -.195(xe)
-3.25 G(cuting a user).195 E(-le)-.26 E -.195(ve)-.325 G 3.25(lt).195 G
(hread \(process\))-3.25 E 3.689<8345>33.336 577.51 S -.195(xe)-3.689 G
.439(cuting a k).195 F .439(ernel thread.)-.13 F .439
(This is identical to a user)6.939 F(-le)-.26 E -.195(ve)-.325 G 3.69
(lt).195 G .44(hread e)-3.69 F .44(xcept that the virtual)-.195 F
(address space is entirely within the k)33.336 592.51 Q(ernel.)-.13 E
3.25<8348>33.336 607.51 S(andling an e)-3.25 E(xception)-.195 E 3.25
<8348>33.336 622.51 S(andling an interrupt)-3.25 E 3.995<8354>33.336
637.51 S .744
(emporarily halted because there is nothing else to do at the moment.)
-4.905 F 2.824 -1.04(We c)7.244 H .744(all this the)1.04 F
("Idle" state.)33.336 652.51 Q(A)33.336 673.51 Q F1 .028(context switch)
3.278 F F2 .029(means changing from one thread \(either k)3.278 F .029
(ernel or user le)-.13 F -.195(ve)-.325 G .029(l\) to another).195 F(.)
-.715 E/F3 13/Times-Italic@0 SF(Conte)33.336 688.51 Q 4.311(xt switc)
-.26 F 4.311(hes can only occur at the instant of r)-.195 F 4.311
(eturning fr)-.481 F 4.311(om an interrupt or)-.585 F -.26(ex)33.336
703.51 S(ecption).26 E F2(.)A .312(While handling an e)33.336 724.51 R
.312(xception or interrupt, it is possible that another e)-.195 F .312
(xception or interrupt)-.195 F .756(will arise.)33.336 739.51 R .756
(Thus the \215o)7.256 F 4.006(wo)-.325 G 4.006(fc)-4.006 G .756
(ontrol in the k)-4.006 F .755
(ernel is multiply re-entrant, and nested.)-.13 F(E.g.)7.255 E 0 Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 8)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF .321(while handling a system call \(e)33.336
120 R .322(xception\), a k)-.195 F -.195(ey)-.13 G .322
(board interrupt is recei).195 F -.195(ve)-.325 G 3.572(d. The).195 F
-.195(ex)3.572 G(ception).195 E 2.741(handler is suspened \(by hardw)
33.336 135 R 2.741(are\) and the k)-.13 F -.195(ey)-.13 G 2.741
(board interrupt handler be).195 F 2.74(gins to run.)-.195 F 1.935
(While servicing that, a disk interrupt is recei)33.336 150 R -.195(ve)
-.325 G 5.185(da).195 G 1.935(nd handled.)-5.185 F 1.935
(When the disk handler)8.435 F 1.748(\214nishes, the k)33.336 165 R
-.195(ey)-.13 G 1.748
(board handler resumes and \214nishes, then the system call is allo).195
F 1.748(wed to)-.325 F(continue.)33.336 180 Q 2.269 -1.04(To s)33.336
201 T .189(implify k)1.04 F .189
(ernel programming and synchronization issues, the Linux k)-.13 F .189
(ernel is carefully)-.13 F 3.758(coded so that k)33.336 216 R 3.758
(ernel code ne)-.13 F -.195(ve)-.325 G 7.008(rp).195 G 3.758(roduces e)
-7.008 F 3.758(xceptions, with one ca)-.195 F -.195(ve)-.26 G 3.758
(at: During the).195 F .964(handling of a system call \(e)33.336 231 R
.965(xception\), a P)-.195 F .965(age F)-.195 F .965(ault \(e)-.195 F
.965(xception\) may be raised.)-.195 F .965(Thus we)7.465 F .96
(can say that e)33.336 246 R .96(xceptions will ne)-.195 F -.195(ve)
-.325 G 4.21(ra).195 G(rri)-4.21 E 1.35 -.195(ve d)-.325 H .96
(uring interrupt handling, and will ne).195 F -.195(ve)-.325 G 4.21(ra)
.195 G(rri)-4.21 E -.195(ve)-.325 G 1.742(during e)33.336 261 R 1.742
(xception handling other than a P)-.195 F 1.742(age F)-.195 F 1.742
(ault during a System Call.)-.195 F 1.742(An interrupt)8.242 F
(may occur at an)33.336 276 Q 3.25(yt)-.195 G
(ime, because it is asynchronous.)-3.25 E/F2 13/Times-Bold@0 SF
(Making a System Call)206.125 306 Q F1 3.619 -1.04(We a)33.336 342 T
1.539(re no)1.04 F 4.789(wr)-.325 G 1.539
(eady to discuss one particular k)-4.789 F 1.538
(ernel control path: the system call.)-.13 F -1.04(We)8.038 G -.13('l)
1.04 G(l).13 E .875(illustrate a f)33.336 357 R .875(airly simple one:)
-.13 F/F3 13/Courier@0 SF(getuid\(\))4.125 E F1 7.375(.A)C(user)-3.25 E
(-le)-.26 E -.195(ve)-.325 G 4.125(lp).195 G .876(rogram calls)-4.125 F
F3(getuid\(\))4.126 E F1 .876(as an)4.126 F .697(ordinary C function.)
33.336 372 R .697(This function is pro)7.197 F .696
(vided by the standard C library which is link)-.195 F(ed)-.13 E 1.167
(with all C programs.)33.336 387 R(The)7.667 E F3(getuid\(\))4.417 E F1
1.167(function is written partially in C and partially in)4.417 F 2.213
(assembly language.)33.336 402 R 2.212(This pro)8.713 F 2.212
(vides the "glue" between the user)-.195 F(-le)-.26 E -.195(ve)-.325 G
5.462(ld).195 G 2.212(omain of the C)-5.462 F(program, and the k)33.336
417 Q(ernel')-.13 E 3.25(ss)-.715 G(ystem call API.)-3.25 E F2
(The 32-bit X86 API)212.989 447 Q F1(Ar)33.336 483 Q .8
(gument passing between user)-.234 F(-le)-.26 E -.195(ve)-.325 G 4.05
(lf).195 G .8(unctions in C is via the stack.)-4.05 F(Ho)7.3 E(we)-.325
E -.195(ve)-.325 G 1.84 -.52(r, d).195 H .8(uring a).52 F 1.463
(system call, the processor will be switching to a dif)33.336 498 R
1.463(ferent, k)-.325 F 1.463(ernel stack.)-.13 F 1.463(The user)7.963 F
(-le)-.26 E -.195(ve)-.325 G(l).195 E .327(program ob)33.336 513 R .327
(viously can not write to the k)-.195 F .327(ernel stack.)-.13 F(Con)
6.827 E -.195(ve)-.52 G(rsely).195 E 3.577(,a)-.845 G .327
(lthough the k)-3.577 F(ernel)-.13 E/F4 13/Times-Italic@0 SF(can)3.577 E
F1 1.591(access the user)33.336 528 R(-le)-.26 E -.195(ve)-.325 G 4.841
(ls).195 G 1.591(tack memory)-4.841 F 4.841(,i)-.845 G 4.841(tw)-4.841 G
1.59(ould rather not, since that might create a P)-4.971 F(age)-.195 E
-.195(Fa)33.336 543 S 3.295(ult. The).195 F .045(solution is to pass ar)
3.295 F .046(guments to system calls in re)-.234 F 3.296(gisters. The)
-.195 F(con)3.296 E -.195(ve)-.52 G .046(ntion used).195 F 2.601
(on the x86-32 architecture is that the 32-bit ar)33.336 558 R 2.601
(guments are passed such that the \214rst)-.234 F(ar)33.336 573 Q 2.004
(gument is in the)-.234 F F3(ebx)5.254 E F1(re)5.254 E(gister)-.195 E
8.504(.T)-.715 G 2.005(he second is placed in the)-8.504 F F3(ecx)5.255
E F1(re)5.255 E(gister)-.195 E 8.505(.T)-.715 G 2.005(he third)-8.505 F
3.03(through sixth are placed in re)33.336 588 R(gisters)-.195 E F3 3.03
(edx, esi, edi, ebp)6.28 F F1(respecti)6.28 E -.195(ve)-.325 G(ly).195 E
9.53(.I)-.845 G 6.28(ft)-9.53 G(he)-6.28 E 1.495(number of ar)33.336 603
R 1.496(guments to the system call e)-.234 F 1.496
(xceeds 6 \(rare\), then all of the ar)-.195 F 1.496(guments are)-.234 F
1.468(placed on the user)33.336 618 R(-le)-.26 E -.195(ve)-.325 G 4.718
(ls).195 G 1.468(tack and the k)-4.718 F 1.468(ernel recei)-.13 F -.195
(ve)-.325 G 4.718(sj).195 G 1.468(ust the address of that ar)-4.718 F
(gument)-.234 E(block.)33.336 633 Q 1.073(Each a)33.336 654 R -.325(va)
-.26 G 1.073
(ilable system call is assigned a speci\214c number by the k).325 F
4.324(ernel. A)-.13 F(gi)4.324 E -.195(ve)-.325 G 4.324(ns).195 G(ystem)
-4.324 E 1.68(call number also has a speci\214cation for what ar)33.336
669 R 1.68(guments are e)-.234 F 4.93(xpected. The)-.195 F 1.68
(standard C)4.93 F 3.42
(library must therefore be compiled, at least in part, with an e)33.336
684 R 3.42(ye to)-.195 F -.13(wa)-.325 G 3.42(rds the e).13 F(xact)-.195
E 2.14(architecture on which the program will be run.)33.336 699 R 2.14
(As the k)8.64 F 2.14(ernel e)-.13 F -.26(vo)-.325 G(lv).26 E 2.14
(es to)-.195 F -.13(wa)-.325 G 2.14(rds higher).13 F -.195(ve)33.336 714
S 2.132(rsion numbers and ne).195 F 5.382(ws)-.325 G 2.132
(ystem calls are added, backw)-5.382 F 2.132
(ards-compatability with older)-.13 F 2.275(code must be maintained.)
33.336 729 R 2.275(System call numbers are not re-used.)8.775 F 2.275
(If it is necessary to)8.775 F .817
(change the semantics of a system call, a ne)33.336 744 R 4.067(wc)-.325
G .818(all is de\214ned with a ne)-4.067 F 4.068(wn)-.325 G(umber)-4.068
E 4.068(,a)-.52 G .818(nd the)-4.068 F 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 9)73.998 E(\2512013 Jef)144.405 E 2.25(fH)-.225 G(akner)-2.25
E/F1 13/Times-Roman@0 SF -.13(ke)33.336 120 S .238(rnel pro).13 F .238
(vides both v)-.195 F 3.488(ersions. In)-.195 F .238(the Linux 2.6.15 v)
3.488 F .238(ersion k)-.195 F .238(ernel, there were 294 de\214ned)-.13
F 1.168(system call numbers, by v)33.336 135 R 1.168
(ersion 2.6.23 that number had gro)-.195 F 1.169
(wn to 325, and by 2.6.32 it)-.325 F(had reached 338!)33.336 150 Q 1.164
(The system call number is passed to the k)33.336 171 R 1.164
(ernel in the)-.13 F/F2 13/Courier@0 SF(eax)4.414 E F1(re)4.414 E
(gister)-.195 E 7.664(.N)-.715 G 1.814 -.325(ow t)-7.664 H 1.163
(he user).325 F(-le)-.26 E -.195(ve)-.325 G(l).195 E F2(getuid)33.336
186 Q F1 1.073(function is ready to actually mak)4.323 F 4.323(et)-.13 G
1.073(he system call.)-4.323 F 1.074(There are no ar)7.574 F 1.074
(guments to)-.234 F .854(this particular system call, so the system cal\
l # corresponding to getuid \(199 decimal\) is)33.336 201 R 1.068
(put in eax and then a special instruction is used.)33.336 216 R 1.068
(There are tw)7.568 F 4.319(ow)-.13 G 1.069(ays to mak)-4.449 F 4.319
(eas)-.13 G(ystem)-4.319 E 4.124(call: using the)33.336 231 R F2 4.124
(INT $0x80)7.374 F F1(softw)7.373 E 4.123(are interrupt e)-.13 F 4.123
(xception instruction, or using the)-.195 F F2(SYSENTER)33.336 246 Q F1
4.278(instruction. W)4.278 F(e')-1.04 E 1.028(ll follo)-.13 F 4.278(wt)
-.325 G 1.028(he former e)-4.278 F 4.278(xample. The)-.195 F 1.028
(reader is referred to the)4.278 F(book)33.336 261 Q/F3 13
/Times-Italic@0 SF(Under)3.25 E(standing the Linux K)-.13 E(ernel)-.455
E F1(for more information on the SYSENTER method.)3.25 E(The)33.336 312
Q F2 .256(INT $0x80)3.506 F F1 .256(instruction causes an e)3.506 F .255
(xception to be raised with v)-.195 F .255(ector code 128.)-.195 F(The)
6.755 E(hardw)33.336 327 Q 2.846(are then v)-.13 F 2.846
(ectors to the k)-.195 F 2.846(ernel entrypoint for v)-.13 F 2.846
(ector 128, which the k)-.195 F 2.846(ernel had)-.13 F 8.409
(initialized to point to the follo)33.336 342 R 8.409
(wing code \(this is a simpli\214ed v)-.325 F 8.408(ersion of)-.195 F
(/usr/src/linux/arch/x86/k)33.336 357 Q(ernel/entry)-.13 E(.S\))-.845 E
/F4 10/Courier@0 SF(system_call:)33.336 369 Q 21.6(pushl %eax)90.936 381
R(#contains system call #)206.4 E 176.4(SAVE_ALL #macro)90.936 393 R
(to push important)6 E(#registers on the stack)378.936 405 Q 27.6
(movl $0xFFFFE000,%ebp)90.936 417 R(#mask SP to get to)76.8 E 27.6
(andl %esp,%ebp)90.936 429 R(#thread_info)118.8 E 21.6
(testw $_TIF_SYSCALL_TRACE,TI_FLAGS\(%ebp\))90.936 441 R
(#test thread_info.flags)26.4 E 33.6(jnz syscall_trace_entry)90.936 453
R(#for syscall tracing on)58.8 E 27.6(cmpl $nr_syscalls,)90.936 465 R
58.8(%eax #bounds)6 F(check)6 E 33.6(jae syscall_badsys)90.936 477 R
27.6(call *sys_call_table\(0,%eax,4\))90.936 489 R(#indirect addressing)
22.8 E 27.6(movl %eax,PT_EAX\(%esp\))90.936 501 R
(#poke return code into EAX slot)70.8 E(syscall_exit:)33.336 513 Q 264
(cli #temporarily)90.936 525 R(mask interrupts)6 E 27.6
(movl TI_flags\(%ebp\),%ecx)90.936 537 R
(#get flags field of thread_info)58.8 E(#ALLWORK_MASK includes all TIF_\
XXX thread info flags that indicate more)39.336 549 Q
(#work might be needed before returning to user space)39.336 561 Q 21.6
(testw $_TIF_ALLWORK_MASK,%cx)90.936 573 R(#see if any flags are set)
98.4 E 33.6(jne syscall_exit_work)90.936 585 R
(#if so more work before exit)70.8 E(restore_all:)33.336 597 Q 210
(RESTORE_REGS #pop)90.936 609 R(registers from stack)6 E 27.6
(addl $4,%esp)90.936 621 R(#discard original eax)188.4 E 258
(iret #return)90.936 633 R(from interrupt)6 E(syscall_badsys:)33.336 645
Q 27.6(movl $-ENOSYS,PT_EAX\(%esp\))90.936 657 R
(#poke error return code)104.4 E 33.6(jmp syscall_exit)90.936 669 R
(#simplified)158.4 E 174(syscall_exit_work: #simplified)33.336 681 R 12
(testb $_TIF_NEED_RESCHED,%cl)90.936 693 R(#flags already in ecx)108 E
39.6(jz work_notifysig)90.936 705 R(#if clear, must be signal pending)
88.8 E(work_resched:)33.336 717 Q 27.6(call schedule)90.936 729 R
(#otherwise, task switch)124.8 E 264(cli #avoid)90.936 741 R
(missing an interrupt)6 E 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 10)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 10/Courier@0 SF 27.6(movl TI_flags\(%ebp\),%ecx)90.936 117 R
(#check flags again)58.8 E 27.6(andl $_TIF_WORK_MASK,%ecx)90.936 129 R
39.6(jz restore_all)90.936 141 R(#OK to return to userland)164.4 E 21.6
(testb $_TIF_NEED_RESCHED,%cl)90.936 153 R 33.6(jnz work_resched)90.936
165 R(#still need rescheduling)158.4 E(work_notifysig:)33.336 177 Q
(#we'll see this code in a later unit)90.936 189 Q/F2 13/Times-Roman@0
SF(The)33.336 204 Q/F3 13/Courier@0 SF(SAVE_ALL)3.818 E F2 .568
(macros pushes all of the re)3.818 F .569(gisters that the k)-.195 F
.569(ernel is lik)-.13 F .569(ely to clobber)-.13 F 7.069(.I)-.715 G(n)
-7.069 E .95(conjunction with the hardw)33.336 219 R .95
(are pushes and the instruction)-.13 F F3 .95(pushl %eax)4.2 F F2 .95
(just abo)4.2 F -.195(ve)-.195 G 4.2(,t).195 G(he)-4.2 E -.13(ke)33.336
234 S(rnel stack no).13 E 3.25(wl)-.325 G(ooks lik)-3.25 E 3.25(et)-.13
G(his:)-3.25 E F1(0x00\(%esp\) - ebx)33.336 246 Q
(general-purpose registers,)76.8 E(0x04\(%esp\) - ecx)33.336 258 Q
(saved by)76.8 E(0x08\(%esp\) - edx)33.336 270 Q(SAVE_ALL)76.8 E
(0x0C\(%esp\) - esi)33.336 282 Q(")76.8 E(0x10\(%esp\) - edi)33.336 294
Q(")76.8 E(0x14\(%esp\) - ebp)33.336 306 Q(")76.8 E(0x18\(%esp\) - eax)
33.336 318 Q 6("\()76.8 G(will be syscall return value\))-6 E
(0x1C\(%esp\) - ds)33.336 330 Q(")140.4 E(0x20\(%esp\) - es)33.336 342 Q
(")140.4 E(0x24\(%esp\) - fs)33.336 354 Q(")140.4 E
(0x28\(%esp\) - orig_eax)33.336 366 Q(orig system_call number)104.4 E
(0x2C\(%esp\) - eip)33.336 378 Q
(program counter in user land, saved by hw)76.8 E(0x30\(%esp\) - cs)
33.336 390 Q(code segment register, saved by hw)140.4 E
(0x34\(%esp\) - eflags)33.336 402 Q(flags register, saved by hw)58.8 E
(0x38\(%esp\) - oldesp)33.336 414 Q
(user-land stack pointer, saved by hw)58.8 E(0x3C\(%esp\) - oldss)33.336
426 Q(user-land stack segment reg, saved by hw)64.8 E F2 1.189(The ne)
33.336 447 R 1.19(xt instruction places a mask into re)-.195 F(gister)
-.195 E F3(ebp)4.44 E F2 1.19(and applies that mask to the stack)4.44 F
(pointer)33.336 462 Q F3(esp)3.838 E F2 7.088(.N)C(ormally)-7.088 E
3.838(,i)-.845 G 3.838(nCp)-3.838 G .588(rograms, the ebp re)-3.838 F
.588(gister has a v)-.195 F .587(ery important function as)-.195 F 1.417
(the local frame pointer)33.336 477 R 7.917(.H)-.715 G -.325(ow)-7.917 G
-2.795 -.325(ev e).325 H 2.457 -.52(r, w).325 H 4.667(ea).52 G 1.417
(re still in an assembly language entrypoint, and)-4.667 F .025
(thus ebp is a)33.336 492 R -.325(va)-.26 G .024(ilable as a scratch re)
.325 F(gister)-.195 E 6.524(.T)-.715 G .024
(he purpose of this masking operation deserv)-6.524 F(es)-.195 E 3.25
(ac)33.336 507 S(onsiderable detour:)-3.25 E/F4 13/Times-Bold@0 SF -.325
(Ke)131.687 537 S -.195(rn).325 G(el-mode stack and the thr).195 E
(ead_inf)-.234 E 3.25(os)-.325 G(tructur)-3.25 E(e)-.234 E F2 2.577
(Recall that the k)33.336 573 R 2.577(ernel allocates an indi)-.13 F
2.577(vidual stack area for each user)-.325 F(-le)-.26 E -.195(ve)-.325
G 5.827(lt).195 G 2.577(hread of)-5.827 F 4.217(control. Depending)
33.336 588 R .967(on k)4.217 F .967(ernel v)-.13 F .966
(ersion and compilation parameters, the size of this stack)-.195 F .767
(may be 4K or 8K.)33.336 603 R -.195(Fo)7.268 G 4.018(rs).195 G
(implicity)-4.018 E 4.018(,w)-.845 G 4.018(ew)-4.018 G .768
(ill assume an 8K stack.)-4.018 F .768(While this seems rather)7.268 F
1.943(small, bear in mind that e)33.336 618 R -.195(ve)-.325 G 1.942
(ry bit of code in the k).195 F 1.942(ernel is carefully controlled.)
-.13 F(Lar)8.442 E(ge)-.234 E 1.612(amounts of local v)33.336 633 R
1.612(ariable space are discouraged, recursi)-.325 F 2.002 -.195(ve p)
-.325 H 1.612(rogramming is ne).195 F -.195(ve)-.325 G 4.862(ru).195 G
(sed,)-4.862 E 3.358
(and the depth of function call nesting rarely gets obnoxious.)33.336
648 R 3.358(Therefore, the k)9.858 F(ernel)-.13 E
(programmers can rely on the f)33.336 663 Q
(act that this 8K stack will not o)-.13 E -.195(ve)-.195 G(r\215o).195 E
-.845(w.)-.325 G(No)33.336 684 Q 2.853 -.845(w, t)-.325 H 4.413(oc).845
G 1.163(ompound this trick)-4.413 F(ery)-.13 E 4.413(,t)-.845 G 1.163
(he k)-4.413 F 1.163(ernel sticks a small data structure called)-.13 F
F3(struct)4.413 E(thread_info)33.336 699 Q F2 1.001
(at the limit of the stack, i.e. at the lo)4.251 F 1.001
(west memory address.)-.325 F 1.001(The k)7.501 F(ernel)-.13 E .762
(stack pointer v)33.336 714 R .762
(alue stored in the TSS memory area by the k)-.325 F .763
(ernel for each process/thread)-.13 F 2.398
(is the highest address of the allocated stack area.)33.336 729 R 2.398
(On entry to the k)8.898 F 2.398(ernel through an)-.13 F -.195(ex)33.336
744 S 2.419(ception or interrupt, the k).195 F 2.419
(ernel stack is empty)-.13 F 5.669(,a)-.845 G 2.419(nd the k)-5.669 F
2.419(ernel stack pointer is thus)-.13 F 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 11)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .119(furthest a)33.336 120 R -.13(wa)
-.195 G 3.368(yf).13 G .118(rom this)-3.368 F/F2 13/Courier@0 SF
(thread_info)3.368 E F1 .118(data structure, and as k)3.368 F .118
(ernel functions are called,)-.13 F
(the stack pointer gets closer to it, b)33.336 135 Q(ut should ne)-.26 E
-.195(ve)-.325 G 3.25(rb).195 G 3.25(ei)-3.25 G 3.25(na)-3.25 G .39
-.195(ny d)-3.25 H(anger of o).195 E -.195(ve)-.195 G -.26(r-).195 G
(writing it.).26 E 3.016
(This arrangement of memory addresses means that on entry to the k)
33.336 156 R 3.016(ernel, a simple)-.13 F 8.379
(masking operation of the stack pointer)33.336 171 R F2(%esp)11.629 E F1
8.379(yields the be)11.629 F 8.379(ginning of the)-.195 F F2
(thread__info)33.336 186 Q F1 3.735(structure. That)3.735 F .485
(address is k)3.735 F .485(ept in the)-.13 F F2(%ebp)3.735 E F1(re)3.735
E .485(gister for a while.)-.195 F(Also,)6.985 E 1.965(at an)33.336 201
R 5.215(yp)-.195 G 1.964(oint in the k)-5.215 F 1.964
(ernel, the inline function)-.13 F F2(current_thread_info\(\))5.214 E F1
(performs)5.214 E 10.329(that same masking operation.)33.336 216 R(Let')
16.829 E 13.579(sl)-.715 G 10.329(ook into the)-13.579 F F2(thread_info)
13.58 E F1(struct)13.58 E
(\(/usr/src/linux/arch/x86/include/asm/thread_info.h\):)33.336 231 Q/F3
10/Courier@0 SF(struct thread_info {)33.336 243 Q(struct task_struct)
81.336 255 Q 54(*task; /*)36 F(main task structure */)6 E
(struct exec_domain)81.336 267 Q 12(*exec_domain; /*)36 F
(execution domain */)6 E(unsigned long)81.336 279 Q 54(flags; /*)66 F
(low level flags */)6 E(unsigned long)81.336 291 Q 48(status; /*)66 F
(thread-synchronous flags */)6 E 108(__u32 cpu;)81.336 303 R
(/* current CPU */)72 E 120(int preempt_count;)81.336 315 R
(/* 0 => preemptable */)12 E 66(mm_segment_t addr_limit;)81.336 327 R
(/* highest valid VA */)30 E 142.8(void *sysenter_return;)90.936 339 R
(/* don't worry */)13.2 E(struct restart_block)81.336 351 Q 6
(restart_block; /*)24 F(for syscall restart */)6 E(#ifdef CONFIG_X86_32)
39.336 363 Q(/* Don't worry about these next two obscure lines */)46.8 E
(unsigned long)81.336 375 Q(previous_esp;)66 E 114
(__u8 supervisor_stack[0];)81.336 387 R(#endif)39.336 399 Q 148.8
(int uaccess_err;)90.936 411 R(/* err from accessing user mem*/)43.2 E
(};)33.336 423 Q F1 .994(There isn')33.336 444 R 4.244(tm)-.234 G .994
(uch room on the k)-4.244 F .994(ernel stack, so)-.13 F F2(thread_info)
4.243 E F1 .993(is pretty small.)4.243 F .993(What is)7.493 F -.13(ke)
33.336 459 S 1.369
(pt in there is only what is needed by the assembly language entry/e).13
F 1.369(xit routines.)-.195 F(The)7.869 E -.13(ke)33.336 474 S .89
(rnel needs to k).13 F .89(eep a lot more information about a process, \
so it allocates another data)-.13 F .384(structure called)33.336 489 R
F2 .385(struct task_struct)3.634 F F1 .385(which is pointed to by)3.635
F F2(thread_info)3.635 E F1 6.885(.T)C(his)-6.885 E
(is an unfortunate and confusing choice of names!)33.336 504 Q .262
(On slightly older Linux k)33.336 525 R .262(ernels, the)-.13 F F2
(task_struct)3.512 E F1 .262(for the process in whose conte)3.512 F .262
(xt the)-.195 F -.13(ke)33.336 540 S 3.333(rnel is running w).13 F 3.333
(as accessed directly by a series of macros which computed the)-.13 F F2
(thread_info)33.336 555 Q F1 3.593(address from the stack pointer)6.843
F 6.842(,t)-.52 G 3.592(hen fetched the \214rst w)-6.842 F 3.592
(ord of that)-.13 F .082(structure to obtain the pointer to the current)
33.336 570 R F2(task_struct)3.332 E F1 6.582(.O)C 3.332(nl)-6.582 G .082
(ater k)-3.332 F .082(ernels, each CPU)-.13 F .742
(maintains a small per)33.336 585 R .742(-CPU pri)-.26 F -.325(va)-.325
G .742(te memory area, and within that area maintains a global).325 F
-.325(va)33.336 600 S(riable called).325 E F2(current_task)3.25 E F1(.)A
(It')33.336 621 Q 6.423(st)-.715 G 3.174
(he responsibility of the part of the k)-6.423 F 3.174(ernel called the)
-.13 F/F4 13/Times-Italic@0 SF(sc)6.424 E(heduler)-.195 E F1 3.174
(to maintain the)6.424 F F2(current_task)33.336 636 Q F1 -.325(va)3.252
G .001(riable and the corresponding structure for each task \(aka proce\
ss, aka).325 F(thread\) on the system.)33.336 651 Q -1.04(We)6.5 G -.13
('l)1.04 G 3.25(ll).13 G(ook inside this structure in the ne)-3.25 E
(xt unit.)-.195 E/F5 13/Times-Bold@0 SF(The X86-64 API)222.2 681 Q F1
.882(Although the e)33.336 717 R .882
(xamples herein are for the older 32-bit X86 API, also kno)-.195 F .883
(wn as i386, we)-.325 F(should e)33.336 732 Q(xamine ho)-.195 E 3.25(wt)
-.325 G(hings change when using the 64-bit API, kno)-3.25 E
(wn as X86-64.)-.325 E 0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 12)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF .039(At user le)33.336 120 R -.195(ve)
-.325 G .039(l, the \214rst 6 ar).195 F .039
(guments to a function are passed in re)-.234 F .039
(gisters, not the stack.)-.195 F(The)6.539 E(ar)33.336 135 Q 1.583
(gument slots are re)-.234 F 1.583(gisters %rdi,%rsi,%rdx,%rcx,%r8,%r9.)
-.195 F 1.583(The X86-64 API does not)8.083 F .401
(use the INT 0x80 instruction, b)33.336 150 R .401(ut a ne)-.26 F 3.651
(wi)-.325 G .401(nstruction called)-3.651 F/F2 13/Courier@0 SF(SYSCALL)
3.651 E F1 3.651(,w)C .401(hich is some)-3.651 F(what)-.325 E -.13(fa)
33.336 165 S(ster).13 E 6.5(.I)-.715 G 3.25(tp)-6.5 G(erforms the follo)
-3.25 E(wing steps in hardw)-.325 E(are:)-.13 E 3.25<8353>33.336 180 S
-2.925 -.26(av e)-3.25 H(the return address \(%rip re)3.51 E
(gister\) in re)-.195 E(gister %rcx \(o)-.195 E -.195(ve)-.195 G
(rwriting its v).195 E(alue\))-.325 E 3.25<8353>33.336 195 S -2.925 -.26
(av e)-3.25 H(the current v)3.51 E(alue of the \215ags re)-.325 E
(gister \(%r\215ags\) in %r11 \(o)-.195 E -.195(ve)-.195 G
(rwriting it too\)).195 E 4.546<834d>33.336 210 S(ak)-4.546 E 4.546(es)
-.13 G 1.296(ome adjustments to the %cs and %ss re)-4.546 F 1.297
(gisters to allo)-.195 F 4.547(wk)-.325 G 1.297(ernel code to e)-4.677 F
-.195(xe)-.195 G(cute).195 E(properly)33.336 225 Q(.)-.845 E 3.25<8353>
33.336 240 S(et the processor to pri)-3.25 E(vile)-.325 E(ged mode)-.195
E 4.009<834c>33.336 255 S .759(oad the v)-4.009 F .759
(alue of a special re)-.325 F .759(gister \(MSR_CST)-.195 F .759
(AR\) into %rip.)-1.209 F .759(This pri)7.259 F(vile)-.325 E .759
(ged re)-.195 F(gister)-.195 E(has been pre-loaded by the k)33.336 270 Q
(ernel to point to the system call entrypoint.)-.13 E .423
(Because the %rcx re)33.336 306 R .424
(gister is clobbered by the SYSCALL instruction, the k)-.195 F(ernel')
-.13 E 3.674(ss)-.715 G(ystem)-3.674 E 2.065(call con)33.336 321 R -.195
(ve)-.52 G 2.065(ntion speci\214es that the ar).195 F 2.065
(guments to the system call are passed in re)-.234 F(gisters:)-.195 E
4.425(%rdi,%rsi,%rdx,%r10,%r8,%r9. The)33.336 336 R 1.176
(system call number is passed in %rax.)4.425 F(Therefore,)7.676 E 1.326
(the user)33.336 351 R(-le)-.26 E -.195(ve)-.325 G 4.576(l").195 G 1.326
(glue" code tak)-4.576 F 1.326(es the 4th ar)-.13 F 1.326
(gument in %rcx and mo)-.234 F -.195(ve)-.195 G 4.576(si).195 G 4.576
(ti)-4.576 G 1.326(nto %r10, and)-4.576 F .679
(adds the system call number in %rax.)33.336 366 R .679(The k)7.179 F
(ernel')-.13 E 3.929(ss)-.715 G .68(ystem call assembly-language entry)
-3.929 F .072(code will put the 4th ar)33.336 381 R .071
(gument back into %rcx from %r10 prior to dispatching to k)-.234 F .071
(ernel C)-.13 F(functions via the system call table.)33.336 396 Q(Unlik)
33.336 417 Q 5.901(et)-.13 G 2.651(he 32-bit API, the 64-bit SYSCALL AP\
I does not change the stack pointer)-5.901 F(.)-.715 E 4.237
(Upon entry via an)33.336 432 R 7.487(yk)-.195 G 4.237
(ernel entrypoint, the k)-7.617 F 4.237(ernel uses the)-.13 F F2(SWAPGS)
7.487 E F1 4.236(instruction to)7.487 F .299(interchange the user)33.336
447 R .299(-mode v)-.26 F .299(alue of the %gs re)-.325 F .299
(gister with a "hidden" %gs re)-.195 F .299(gister that the)-.195 F -.13
(ke)33.336 462 S 2.743(rnel has pre-con\214gured.).13 F 2.743(This re)
9.243 F 2.743(gister can be used in conjunction with an obscure)-.195 F
.718(aspect of X86 programming kno)33.336 477 R .718(wn as "se)-.325 F
.718(gment o)-.195 F -.195(ve)-.195 G .718(rride", allo).195 F .719
(wing access to a reserv)-.325 F(ed)-.195 E 2.885(area of ph)33.336 492
R 2.885(ysical memory that the k)-.065 F 2.885
(ernel has pre-con\214gured.)-.13 F 2.885(It contains an array of)9.385
F .317(scratchpad areas, one for each processor)33.336 507 R 3.567(,k)
-.52 G(no)-3.567 E .318(wn as the "per_cpu" areas.)-.325 F .318(The v)
6.818 F .318(alue of the)-.325 F -.13(ke)33.336 522 S 1.585
(rnel stack pointer w).13 F 1.584(as sa)-.13 F -.195(ve)-.26 G 4.834(di)
.195 G 4.834(nt)-4.834 G 1.584(his per)-4.834 F 1.584
(-cpu area before control w)-.26 F 1.584(as returned to user)-.13 F
4.274(mode. Therefore,)33.336 537 R 1.024(on entry to the k)4.274 F
1.024(ernel, this sa)-.13 F -.195(ve)-.26 G 4.274(dk).195 G 1.024
(ernel stack pointer is retrie)-4.404 F -.195(ve)-.325 G 4.275(da).195 G
(nd)-4.275 E 2.809(processing of the system call \(or f)33.336 552 R
2.809(ault or interrupt\) continues within the k)-.13 F 2.809
(ernel in a)-.13 F(normal C en)33.336 567 Q(vironment.)-.52 E .284
(The k)33.336 588 R .284(ernel of course has sa)-.13 F -.195(ve)-.26 G
3.534(da).195 G .284(ll re)-3.534 F .284
(gisters once it has established the k)-.195 F .285(ernel stack.)-.13 F
(Prior)6.785 E .41(to return to user mode, the k)33.336 603 R .41
(ernel mak)-.13 F .41(es sure that the k)-.13 F .41
(ernel stack pointer is stored in the)-.13 F(per)33.336 618 Q .113
(-cpu scratchpad area, and restores the user)-.26 F .114
(-mode %rip and %r\215ags v)-.26 F .114(alues \(which were)-.325 F(sa)
33.336 633 Q -.195(ve)-.26 G 4.056(do).195 G 4.056(nt)-4.056 G .806
(he k)-4.056 F .806(ernel stack\) into %rcx and %r11 respecti)-.13 F
-.195(ve)-.325 G(ly).195 E 7.306(.T)-.845 G(he)-7.306 E F2(SYSRET)4.056
E F1 .806(instruction is)4.056 F(then used to re)33.336 648 Q -.195(ve)
-.325 G(rse the ef).195 E(fects of)-.325 E F2(SYSCALL)3.25 E F1
(and return control to user mode.)3.25 E .856(If the abo)33.336 669 R
1.246 -.195(ve d)-.195 H .856
(escription of X86-64 caused pain and/or confusion, do not panic.).195 F
2.937 -1.04(We w)7.357 H(ill)1.04 E(conduct the rest of our e)33.336 684
Q(xamples in 32 bits.)-.195 E/F3 13/Times-Bold@0 SF(No)131.98 729 Q 1.43
-.715(w, b)-.13 H(ack to our system call, alr).715 E(eady in pr)-.234 E
(ogr)-.234 E(ess)-.234 E 0 Cg EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 13)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(Ha)33.336 120 Q 2.723
(ving computed the address of the thread_info structure, the ne)-.26 F
2.722(xt line of assembly)-.195 F -.195(ex)33.336 135 S 3.162
(amines a bitwise \215ags w).195 F 6.412(ord. There)-.13 F 3.162
(are quite a fe)6.412 F(w)-.325 E/F2 13/Courier@0 SF(TIF_XXX)6.412 E F1
3.162(\215ags de\214ned.)6.412 F(Of)9.662 E .618
(interest here is a tracing hook: if the)33.336 150 R F2
(TIF_SYSCALL_TRACE)3.867 E F1 .617(\215ag is set, then the thread)3.867
F 2.321(making the system call is being traced \(e.g. through the)33.336
165 R F2(strace)5.571 E F1 2.321(command\) and the)5.571 F -.13(ke)
33.336 180 S 1.55(rnel di).13 F -.195(ve)-.325 G 1.55(rts to an alterna\
te entry which will record the parameters of the system call).195 F
(and pass them back as an e)33.336 195 Q -.195(ve)-.325 G
(nt to the tracer).195 E 6.5(.W)-.715 G 3.25(ew)-7.54 G(on')-3.38 E 3.25
(tg)-.234 G 3.25(od)-3.25 G -.325(ow)-3.25 G 3.25(nt).325 G
(hat road, ho)-3.25 E(we)-.325 E -.195(ve)-.325 G -.715(r.).195 G 1.187
(The ne)33.336 216 R 1.187(xt tw)-.195 F 4.437(ol)-.13 G 1.187
(ines are v)-4.437 F 1.188(ery important, as the)-.195 F 4.438(yi)-.195
G 1.188(llustrate data v)-4.438 F 4.438(alidation. Recall)-.325 F 1.188
(that the)4.438 F(user)33.336 231 Q(-le)-.26 E -.195(ve)-.325 G 3.59(lp)
.195 G .34(rocess is completely untrusted as f)-3.59 F .34(ar as the k)
-.13 F .34(ernel is concerned.)-.13 F .339(If the system)6.84 F 3.462(c\
all number passed by the user is greater than the highest system call n\
umber \(or)33.336 246 R(ne)33.336 261 Q -.065(ga)-.195 G(ti).065 E -.195
(ve)-.325 G 1.533(...think about tw).195 F(o')-.13 E 4.783(sc)-.715 G
1.533(omplement\) then the)-4.783 F F2(syscall_badsys)4.782 E F1 1.532
(code is jumped)4.782 F 3.873(to. This)33.336 276 R .623
(places an error code into the slot in the stack where the user')3.873 F
(s)-.715 E F2(eax)3.874 E F1(re)3.874 E .624(gister w)-.195 F(as)-.13 E
(sa)33.336 291 Q -.195(ve)-.26 G 3.25(d. Upon).195 F -.195(ex)3.25 G
(it from the system call handler).195 E 3.25(,t)-.52 G(his v)-3.25 E
(alue will be popped into %eax.)-.325 E/F3 13/Times-Bold@0 SF
(System Call Retur)195.634 306 Q 3.25(nV)-.195 G(alue)-4.446 E F1 1.043
(On the X86 architecture, when a function returns an int \(or other 32-\
bit v)33.336 342 R 1.042(alue such as a)-.325 F .75(pointer\), that v)
33.336 357 R .75(alue is returned in the)-.325 F F2(eax)4 E F1(re)4 E
(gister)-.195 E 7.25(.A)-.715 G .75(ll return v)-7.25 F .751
(alues from k)-.325 F .751(ernel system)-.13 F 1.415(calls are in f)
33.336 372 R 1.415(act signed inte)-.13 F 4.665(gers. A)-.195 F(ne)4.665
E -.065(ga)-.195 G(ti).065 E 1.805 -.195(ve v)-.325 H 1.414
(alue is used to indicate an error)-.13 F 4.664(,a)-.52 G 1.414(nd that)
-4.664 F -.325(va)33.336 387 S(lue is in f).325 E(act -error_number)-.13
E(.)-.715 E 1.306(Therefore, an in)33.336 408 R -.325(va)-.52 G 1.306
(lid system call will return the v).325 F 1.306
(alue -ENOSYS via the %eax re)-.325 F(gister)-.195 E(.)-.715 E(No)33.336
423 Q 3.224 -.845(w, a)-.325 H 4.784(nu).845 G 1.534
(nfortunate history lesson crops up.)-4.784 F 1.534
(The UNIX API, for reasons that may be)8.034 F 2.369
(lost to time, speci\214es that when system calls f)33.336 438 R 2.37
(ail, the)-.13 F 5.62(ys)-.195 G 2.37(hould set the global v)-5.62 F
(ariable)-.325 E(errno, and return -1.)33.336 453 Q(So the user)6.5 E
(-le)-.26 E -.195(ve)-.325 G 3.25(lg).195 G
(lue function does this \(pseudocode\):)-3.25 E/F4 10/Courier@0 SF
(int generic_system_call\(arguments...\))33.336 465 Q({)33.336 477 Q
(put arguments into registers)90.936 489 Q(put system call # into %eax)
90.936 501 Q(INT $0x80)90.936 513 Q(if \(%eax<0\))90.936 525 Q({)90.936
537 Q(errno= -%eax;)148.536 549 Q(return -1;)148.536 561 Q(})90.936 573
Q(return %eax;)90.936 585 Q(})33.336 597 Q F3 -.325(Ke)177.87 627 S
-.195(rn).325 G(el system call hand-off to C).195 E F1(Ho)33.336 663 Q
(we)-.325 E -.195(ve)-.325 G 1.658 -.52(r, w).195 H 3.868(ek).52 G(no)
-3.868 E 3.868(wi)-.325 G 3.868(nt)-3.868 G .618(his case that a v)
-3.868 F .617(alid system call number w)-.325 F .617(as used.)-.13 F
2.697 -1.04(We h)7.117 H -2.925 -.26(av e)1.04 H(been)4.127 E 3.926
(tracing out assembly language code, b)33.336 678 R 3.926
(ut most of the k)-.26 F 3.926(ernel is written in C.)-.13 F(The)10.426
E(instruction)33.336 693 Q F4 18(call *sys_call_table\(0,%eax,4\))90.936
705 R F1 2.759(uses the X86 inde)33.336 720 R -.195(xe)-.195 G 6.008(dr)
.195 G -.195(eg)-6.008 G 2.758(ister of).195 F 2.758
(fset indirect addressing mode as follo)-.325 F 2.758(ws: The %eax)-.325
F(re)33.336 735 Q 1.461(gister \(containing the system call #\) is mult\
ipled by 4 \(the sizeof a pointer\), and that)-.195 F 0 Cg EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 14)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF(of)33.336 120 Q 1.408
(fset is added to the base address of a table of function pointers)-.325
F/F2 13/Courier@0 SF(sys_call_table)4.658 E F1(.)A .137
(The result of that addition is used to fetch 4 bytes from memory)33.336
135 R 3.388(,a)-.845 G .138(nd _that_ address is the)-3.388 F
(one which is called as a subroutine.)33.336 150 Q(It is)6.5 E/F3 13
/Times-Italic@0 SF(as if)3.25 E F1(:)A/F4 10/Courier@0 SF
(void \(*sys_call_table[]\)\(\);)45.336 162 Q
(/* Declare array of function pointers*/)56.4 E
(\(*sys_call_table[%eax]\)\(args\);)90.936 174 Q F1 .494(When the k)
33.336 195 R .493(ernel is compiled, the sys_call_table is \214lled in \
with the name \(i.e. the virtual)-.13 F .417
(address\) of each C function which implements each system call.)33.336
210 R .417(It is the con)6.917 F -.195(ve)-.52 G .417(ntion that).195 F
4.637(as)33.336 225 S 1.386(ystem call which is kno)-4.637 F 1.386
(wn as XXX to the user is implemented by a k)-.325 F 1.386
(ernel function)-.13 F(called sys_XXX.)33.336 240 Q F4
(asmlinkage long sys_getuid\(void\))33.336 267 Q({)33.336 279 Q
(return current->cred->uid;)81.336 291 Q
(/*cred is the credentials info */)26.4 E(})33.336 303 Q F1 2.083
(This system call is coded purely in C, and is in f)33.336 324 R 2.084
(act found in the architecture-neutral)-.13 F 2.814(portion of the k)
33.336 339 R 2.813(ernel source code \(at /usr/src/linux/k)-.13 F
(ernel/timer)-.13 E 6.063(.c\). The)-.715 F 2.813(only unusual)6.063 F
.677(thing is the compiler directi)33.336 354 R -.195(ve)-.325 G F2
(asmlinkage)4.122 E F1 3.927(,w)C .677
(hich indicates that this function is being)-3.927 F 3.968
(called directly from assembly language, and thus the ar)33.336 369 R
3.968(guments are passed in the)-.234 F(re)33.336 384 Q 5.298
(gisters. \(to)-.195 F 2.048(be precise,)5.298 F F2(asmlinkage)5.298 E
F1 2.048(is a macro which e)5.298 F 2.048(xpands out to other)-.195 F
5.298(,m)-.52 G(ore)-5.298 E 1.405
(confusing, gcc-speci\214c compiler directi)33.336 399 R -.195(ve)-.325
G 7.905(s\). If).195 F 1.405(you look in the source code you w)4.655 F
(on')-.13 E(t)-.234 E .061(\214nd the e)33.336 414 R .061(xact code abo)
-.195 F -.195(ve)-.195 G 3.312(,i).195 G 3.312(nw)-3.312 G .062
(hich some of the macros ha)-3.312 F .452 -.195(ve b)-.26 H .062(een e)
.195 F .062(xpanded out for better)-.195 F(readability)33.336 429 Q(.)
-.845 E .704(Note that the uid is a property of the currently running p\
rocess, and thus is fetched from)33.336 450 R(the)33.336 465 Q F2
(current_task)3.25 E F1(structure via the)3.25 E F2(current)3.25 E F1
(pointer)3.25 E(.)-.715 E(Let')33.336 486 Q 3.25(st)-.715 G(ak)-3.25 E
3.25(eal)-.13 G(ook at another system call \()-3.25 E F2(time)A F1 3.25
(\)w)C(hich passes an ar)-3.25 E(gument:)-.234 E F4
(asmlinkage long sys_time\(time_t __user * tloc\))33.336 498 Q({)33.336
510 Q(time_t i;)81.336 522 Q(struct timespec tv;)81.336 534 Q
(getnstimeofday\(&tv\);)81.336 558 Q 6(i=t)81.336 570 S(v.tv_sec;)-6 E
(if \(tloc\) {)81.336 594 Q(if \(put_user\(i,tloc\)\))129.336 606 Q 6
(i=-)177.336 618 S(EFAULT;)-6 E(})81.336 630 Q(return i;)81.336 642 Q(})
33.336 654 Q F1 1.709(Recall that)33.336 675 R F2(time)4.959 E F1 1.709
(returns the time as an int, b)4.959 F 1.709
(ut also accepts a pointer to an int.)-.26 F(That)8.21 E(ar)33.336 690 Q
1.659(gument comes in to the system call as)-.234 F F2(tloc)4.908 E F1
1.658(in the code abo)4.908 F -.195(ve)-.195 G 4.908(,a).195 G 1.658
(nd if supplied, the)-4.908 F -.13(ke)33.336 705 S 2.325(rnel tak).13 F
2.325(es the v)-.13 F 2.325(alue and writes it into the user')-.325 F
5.575(sm)-.715 G 2.325(emory using the k)-5.575 F 2.326(ernel function)
-.13 F F2(put_user)33.336 720 Q F1 7.168(.W)C(e')-8.208 E .668(ll ha)
-.13 F 1.058 -.195(ve a b)-.26 H .668
(it more to say about accessing user memory from within the).195 F -.13
(ke)33.336 735 S(rnel in a fe).13 E 3.25(wu)-.325 G(nits.)-3.25 E 0 Cg
EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 15)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Bold@0 SF(Retur)187.035 120 Q(ning fr)-.195 E
(om a system call)-.234 E/F2 13/Times-Roman@0 SF 1.625
(Once the system call speci\214c handler routine)33.336 156 R/F3 13
/Courier@0 SF(sys_XXX)4.875 E F2 1.625(returns, the system call return)
4.875 F -.325(va)33.336 171 S .175(lue is in the).325 F F3(%eax)3.424 E
F2(re)3.424 E .174(gister \(because that')-.195 F 3.424(sw)-.715 G .174
(here C function return v)-3.424 F .174(alues are placed by)-.325 F
1.135(the compiler\).)33.336 186 R 1.136(Looking back at the)7.635 F F3
(system_call)4.386 E F2 1.136(assembly language routine, we see)4.386 F
.614(this return v)33.336 201 R .614(alue is written to the k)-.325 F
.613(ernel stack in the location where the)-.13 F F3(eax)3.863 E F2(re)
3.863 E .613(gister will)-.195 F
(be popped when returning back to user mode.)33.336 216 Q(No)33.336 237
Q 5.546(wa)-.325 G 5.546(tl)-5.546 G(abel)-5.546 E F3(syscall_exit)5.546
E F2 2.297(interrupts are temporarily mask)5.547 F 2.297
(ed \(on multi-processor)-.13 F 1.689
(systems, this applies to the local processor only\).)33.336 252 R 1.688
(The reason for this is to protect the)8.188 F(ne)33.336 267 Q 5.06
(xt fe)-.195 F 8.31(wt)-.325 G 5.06
(esting and branching instructions as a critical re)-8.31 F 8.311
(gion. Recall)-.195 F 5.061(that the)8.311 F F3(thread_info)33.336 282 Q
F2 .048(structure address is in)3.298 F F3(%ebp)3.298 E F2 6.548(.T)C
.048(he ne)-6.548 F .048(xt line of assembly code fetches the)-.195 F
(bitwise)33.336 297 Q F3(flags)5.805 E F2 2.555(into re)5.805 F(gister)
-.195 E F3(%ecx)5.806 E F2 2.556(and tests to see if an)5.806 F 5.806
<798d>-.195 G 2.556(ags are set which w)-5.806 F(ould)-.13 E 2.643(indi\
cate that, instead of returning directly to user mode, some other actio\
n might be)33.336 312 R 8.311(required. Let')33.336 327 R 8.311(ss)-.715
G 5.062(ay for a moment that those \215ags are clear)-8.311 F 11.562(.T)
-.715 G 5.062(hen the code at)-11.562 F F3(restore_all)33.336 342 Q F2
2.103(uses a macro)5.353 F F3(RESTORE_REGS)5.353 E F2 2.103
(to pop all of the re)5.353 F 2.102(gisters which had)-.195 F .391
(been sa)33.336 357 R -.195(ve)-.26 G 3.641(db).195 G(y)-3.641 E F3
(SAVE_REGS)3.642 E F2 6.892(.T)C .392(he system call return v)-6.892 F
.392(alue is no)-.325 F 3.642(wi)-.325 G(n)-3.642 E F3(%eax)3.642 E F2
(\(re)3.642 E -.065(ga)-.195 G .392(rdless of).065 F(ho)33.336 372 Q
8.011(wc)-.325 G 4.761(ontrol reached)-8.011 F F3(restore_all)8.011 E F2
8.011(\)a)C 4.76(nd the e)-8.011 F 4.76(xtra stack)-.195 F 4.76(ed cop)
-.13 F 8.01(yo)-.13 G(f)-8.01 E F3(eax)8.01 E F2(which)8.01 E
(contained the system call number is simply discarded.)33.336 387 Q(No)
33.336 408 Q 5.049(wt)-.325 G(he)-5.049 E F3(iret)5.049 E F2 1.799
(instruction is e)5.049 F -.195(xe)-.195 G 5.049(cuted. This).195 F
1.799(causes the hardw)5.049 F 1.799(are to restore the)-.13 F F3(eip,)
5.049 E .686(cs, eflags, esp)33.336 423 R F2(and)3.936 E F3(ss)3.936 E
F2(re)3.935 E 3.935(gisters. The)-.195 F .685(result is that e)3.935 F
-.195(xe)-.195 G .685(cution resumes in the user).195 F .188
(process, with the stack pointer back on the user')33.336 438 R 3.439
(ss)-.715 G 3.439(tack. All)-3.439 F .189(of the re)3.439 F .189
(gisters are e)-.195 F .189(xactly as)-.195 F(the)33.336 453 Q 7.446(yw)
-.195 G 4.196(ere when the user process e)-7.446 F -.195(xe)-.195 G
4.196(cuted the).195 F F3 4.196(INT $0x80)7.446 F F2 4.195
(instruction, with the)7.445 F -.195(ex)33.336 468 S 3.702
(ception of the).195 F F3(eax)6.952 E F2(re)6.952 E 3.702
(gister which no)-.195 F 6.952(wh)-.325 G 3.702
(olds the system call return v)-6.952 F 6.952(alue. The)-.325 F .027
(restoration of the)33.336 483 R F3(eflags)3.277 E F2(re)3.277 E .027
(gister means the pri)-.195 F(vile)-.325 E .027(ge le)-.195 F -.195(ve)
-.325 G 3.277(li).195 G 3.277(sr)-3.277 G .027
(eturned to user mode, and)-3.277 F .159
(the interrupt mask is restored to the normal v)33.336 498 R .159
(alue \(which when running in user mode is to)-.325 F(allo)33.336 513 Q
3.25(wi)-.325 G(nterrupts\).)-3.25 E F1(Deferr)176.095 543 Q(ed r)-.234
E(etur)-.234 E 3.25(nf)-.195 G -.234(ro)-3.25 G 3.25(ms).234 G
(ystem call)-3.25 E F2 1.39
(It may happen that while the process is in the k)33.336 579 R 1.39
(ernel, something happens which mak)-.13 F(es)-.13 E 1.895
(another process potentially more runnable.)33.336 594 R 1.896
(In the ne)8.396 F 1.896(xt unit, we')-.195 F 1.896(ll see ho)-.13 F
5.146(ws)-.325 G(cheduling)-5.146 E .457(decisions are made.)33.336 609
R .457
(It could also happen that a signal has been posted to the process.)
6.957 F(In)6.956 E(these cases, control does not necessarily return bac\
k to user mode after the system call.)33.336 624 Q 3.71
(Referring to the)33.336 645 R F3(entry.S)6.96 E F2 3.71(code, if the)
6.96 F F3(TIF_NEED_RESCHED)6.96 E F2 3.711(\215ag is set, then at)6.961
F F3(work_resched)33.336 660 Q F2 .485(the k)3.735 F .485
(ernel scheduler function)-.13 F F3(schedule)3.735 E F2 .484(is called.)
3.735 F -1.04(We)6.984 G -.13('l)1.04 G 3.734(ls).13 G .484
(ee that this)-3.734 F 2.591
(function, if it picks another process to run, causes a)33.336 675 R/F4
13/Times-Italic@0 SF(conte)5.841 E 2.591(xt switc)-.26 F(h)-.195 E F2
5.841(,a)C 2.591(nd the original)-5.841 F 5.843
(process appears to be frozen at the instant of ha)33.336 690 R 5.842
(ving called)-.26 F F3(schedule)9.092 E F2(from)9.092 E F3(work_resched)
33.336 705 Q F2 7.448(.A)C 4.198(ts)-7.448 G .948
(ome later time, the original process is selected to run ag)-4.198 F
.948(ain, and)-.065 F -.195(exe)33.336 720 S 1.428
(cution resumes at that frozen point.).195 F 1.428(Control returns from)
7.928 F F3(schedule)4.678 E F2 4.678(,a)C 1.427(nd then the)-4.678 F(ne)
33.336 735 Q .949(xt fe)-.195 F 4.199(wl)-.325 G .95
(ines are identical to those we ha)-4.199 F 1.34 -.195(ve a)-.26 H .95
(lready seen: the).195 F 4.2(yc)-.195 G .95(heck to see if an)-4.2 F
(ything)-.195 E 0 Cg EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(ECE357:Computer Operating Systems)33.336 60 Q
(Unit 8/pg 16)71.748 E(\2512013 Jef)142.155 E 2.25(fH)-.225 G(akner)
-2.25 E/F1 13/Times-Roman@0 SF
(else has come up, or whether it is OK to return to user mode.)33.336
120 Q/F2 13/Courier@0 SF(work_notifysig)33.336 141 Q F1 1.463
(is used when a signal has been posted to the process, and will be)4.714
F(discussed in a future unit.)33.336 156 Q 0 Cg EP
%%Trailer
end
%%EOF
